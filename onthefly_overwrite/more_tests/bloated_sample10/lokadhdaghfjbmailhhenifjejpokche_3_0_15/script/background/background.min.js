RegExp.quote=function(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var l="undefined"!=typeof DEVELOPMENT?"lingapps.titan.wizkids.dk":"lingapps.dk",m,p=null,q=localStorage.currentProfileName,r="undefined",t=!1,u=JSON.parse(localStorage.getItem("IS_PINNED")||"true"),aa=JSON.parse(localStorage.getItem("PREDICTION_POPUP_POSITION")||JSON.stringify({x:0,y:0})),v={da:"da-DK",en:"en-GB",en_GB:"en-GB",en_US:"en-GB"}[chrome.i18n.getMessage("@@ui_locale")]||"en-GB";delete localStorage.currentPageId;
chrome.browserAction.setTitle({title:"AppWriter Cloud - "+chrome.i18n.getMessage("notLoggedIn")});chrome.browserAction.setBadgeText({text:"!"});chrome.browserAction.setBadgeBackgroundColor({color:"#ffcc00"});function ba(a,c){localStorage.setItem("PREDICTION_POPUP_POSITION",JSON.stringify(aa={x:a,y:c}))}
function w(a,c,b,d,e,f){var g=[],h;for(h in b)g.push(h+"="+encodeURIComponent(b[h]));g=g.join("&");"GET"!=c||g.trim().match(/^\s*$/)||(a+="?"+g);var k=new XMLHttpRequest;k.onreadystatechange=function(){if(4==k.readyState)if(200==k.status){var a=k.responseText;e&&e(a)}else f&&f(k.status)};k.open(c,a,!0);k.setRequestHeader("Cache-Control","no-cache");k.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(d)for(var n in d)k.setRequestHeader(n,d[n]);"GET"==c?k.send(null):k.send(g)}
function ca(a,c){var b={"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId};return new Promise(function(d,e){var f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&(200===f.status?d(f.responseText):e(f.status))};f.open("POST",a,!0);f.setRequestHeader("Cache-Control","no-cache");if(b)for(var g in b)f.setRequestHeader(g,b[g]);f.send(c)})}function x(a,c){this.name=a||this.name;this.message=c||this.message}
x.prototype=function(a,c){function b(){}b.prototype=c.prototype;return new b}(x,Error);x.prototype.name="LingappsError";
function da(a,c){var b=a.user;localStorage.setItem("sessionType",c||"normal");localStorage.setItem("sessionId",a.sessionId);y(a.user);switch(z(b.extraInfo.appwriterCloudLicense)){case A:throw new x("LICENSE_NO_LICENSE","No license for session.");case ea:throw new x("LICENSE_DISABLED","License has been disabled.");case fa:throw new x("LICENSE_EXPIRED","License has expired.");case ga:throw new x("LICENSE_NO_LANGUAGUES","License has no languages.");}return(new Promise(function(a){B(!1,null,null,a)})).then(function(a){if("success"!==
a.status)throw new x(a.errorCode,a.errorMessage);p=a.data;if(!p)throw new x("INTERNAL_ERROR","Profiles was not downloaded.");return new Promise(function(a){C(q,a)})})}function y(a){t=!0;D=a;E=D.extraInfo.appwriterCloudLicense;F=z(E);G({action:"setSessionId",sessionId:localStorage.sessionId});G({action:"setLoggedIn",isLoggedIn:t});ha();chrome.browserAction.setTitle({title:"AppWriter Cloud"});chrome.browserAction.setBadgeText({text:""});setTimeout(function(){F==I&&ia()},1E3)}
function J(){delete localStorage.sessionType;delete localStorage.sessionId;t=!1;E=D=null;F=A;ha();G({action:"setLoggedIn",isLoggedIn:t});p=null;C();chrome.browserAction.setTitle({title:"AppWriter Cloud - "+chrome.i18n.getMessage("notLoggedIn")});chrome.browserAction.setBadgeText({text:"!"});chrome.browserAction.setBadgeBackgroundColor({color:"#ffcc00"})}
function ja(){"selected"==r&&m.wordPredictions?(chrome.browserAction.setTitle({title:"AppWriter Cloud"}),chrome.browserAction.setBadgeText({text:""})):(chrome.browserAction.setTitle({title:"AppWriter Cloud - "+chrome.i18n.getMessage("wordPredictionOff")}),chrome.browserAction.setBadgeText({text:"/"}),chrome.browserAction.setBadgeBackgroundColor({color:"#cccccc"}))}var ka=!1;
chrome.webRequest.onBeforeSendHeaders.addListener(function(a){!ka&&localStorage.sessionId&&a.requestHeaders.push({name:"AppWriter-Session-ID",value:localStorage.sessionId});ka=!1;return{requestHeaders:a.requestHeaders}},{urls:["https://admin."+l+"/user/login*","https://user."+l+"/user/login*"]},["requestHeaders","blocking"]);chrome.webRequest.onHeadersReceived.addListener(function(){ka=!0},{urls:["https://admin."+l+"/user/logout*","https://user."+l+"/user/logout*"]});
chrome.webRequest.onHeadersReceived.addListener(function(a){function c(){localStorage.sessionType="edulife";localStorage.sessionId=e.data.sessionId;y(e.data.user);F!=I?K():B(!1,null,null,function(a){"success"==a.status?(p=a.data,p[q]?C(q):C()):K()})}for(var b=0;b<a.responseHeaders.length;b++){var d=a.responseHeaders[b];if("LingApps-Response"==d.name){try{var e=JSON.parse(d.value);"success"==e.status?localStorage.sessionType?K(c):setTimeout(c,0):console.log("EduLife login error",F,E,D)}catch(f){}break}}},
{urls:["https://services."+l+"/user/edulifeLogin*"]},["responseHeaders"]);var la;chrome.webRequest.onHeadersReceived.addListener(function(){(function c(){L?"edulife"==localStorage.sessionType&&K():(clearTimeout(la),la=setTimeout(c,1E3))})()},{urls:["*://accounts.google.com/Logout*"]});function ma(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return a[b];return null}
chrome.webRequest.onHeadersReceived.addListener(function(a){var c=ma(a.responseHeaders,"LingApps-Actions");if(c){c=c.value;a=a.tabId;for(var c=c.split(","),b=0;b<c.length;b++)"close-window"==c[b]?chrome.tabs.remove(a):"logout"==c[b]&&K()}},{urls:["https://*."+l+"/*"]},["responseHeaders"]);var N={},na=-1,oa={},pa={};
chrome.webRequest.onHeadersReceived.addListener(function(a){if(-1!==a.tabId){var c=ma(a.responseHeaders,"Content-Type");N[a.tabId]=c?c&&c.value.split(";",1)[0]:"text/plain"}},{urls:["*://*/*"],types:["main_frame"]},["responseHeaders"]);chrome.tabs.onRemoved.addListener(function(a){N[a]&&delete N[a]});chrome.tabs.onActivated.addListener(function(a){oa[a.windowId]=a.tabId;chrome.tabs.get(a.tabId,function(a){pa[a.windowId]=a.url})});chrome.windows.onFocusChanged.addListener(function(a){na=a});
chrome.windows.onCreated.addListener(function(a){oa[a]=-1;pa[a]=""});chrome.windows.onRemoved.addListener(function(a){delete oa[a];delete pa[a]});
chrome.webRequest.onCompleted.addListener(function(a){if(localStorage.sessionId&&(a=a.url.match(/^https?:\/\/ordnet\.dk\/ddo\/ordbog\?(.*)$/))){a=a[1].split("&");for(var c={},b=0;b<a.length;b++){var d=a[b].split("=");c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}(a=c.aselect||c.select||c.query)&&w("http://stats.appwriterlog.wizkids.dk/dictionary/lookup","POST",{data:JSON.stringify({data:{language:"da-DK",word:a.replace(/[\u200B]+/g,""),method:"ddo"},time:Date.now()})},{"LingApps-User-Session-ID":localStorage.sessionId,
"LingApps-Application":"appwriter_cloud"})}},{urls:["*://ordnet.dk/ddo/ordbog?*"],types:["main_frame"]});var qa=["content-security-policy","x-content-security-policy","x-webkit-csp"],ra="* 'none' 'self' data: mediastream: blob: filesystem: 'unsafe-inline' 'unsafe-eval'".split(" "),sa=/(([a-zA-Z]+):\/\/)?(\*\.)?([a-zA-Z0-9\.\_\-]+)(:([0-9]+|\*))?/;function ta(){this.a={}}function ua(a,c){a.a["media-src"]||a.a["default-src"]?a.a["media-src"]?a.a["media-src"].push(c):a.a["default-src"]&&a.a["default-src"].push(c):(a.a["media-src"]=["*"],a.a["media-src"].push(c))}
function va(a,c){var b=a.a["media-src"]||a.a["default-src"];if(!b||-1!==b.indexOf("*"))return!0;if(-1!==b.indexOf("'none'"))return!1;for(var d=c.match(sa),e=d[2],f=d[4],d=d[6],g=0;g<b.length;g++)if(-1===ra.indexOf(b[g])){var h=b[g].match(sa);if(h){var k=h[2],n=!!h[3],H=h[4],h=h[6];if(k&&k===e&&(n&&f.substring(Math.max(f.length-H.length,0))===H||!n&&f===H)&&(!h||"*"===h||h===d))return!0}}return!1}
chrome.webRequest.onHeadersReceived.addListener(function(a){var c=a.responseHeaders;try{for(var b=0;b<c.length;b++)if(-1!==qa.indexOf(c[b].name.toLowerCase())){for(var d,e=c[b].value,f=e.split(";"),g={},h=0;h<f.length;h++){var k=f[h].trim().split(/\s+/g),n=k.shift();n&&(g[n]=k)}e=new ta;e.a=g;d=e;va(d,"static."+l)||ua(d,"static."+l);va(d,"tts."+l)||ua(d,"tts."+l);var H=c[b],g=d,h=[],M=void 0;for(M in g.a)g.a.hasOwnProperty(M)&&h.push(M+" "+g.a[M].join(" "));H.value=h.join("; ")}}catch(jb){console.error(jb)}return{responseHeaders:a.responseHeaders}},
{urls:["<all_urls>"]},["blocking","responseHeaders"]);var D,wa={wordPredictions:"wordPredictions",wordPredictionsLanguage:"wordPredictionsLanguage",wordPredictionsContextIndependent:"wordPredictionsContextIndependent",readLetters:"readLetters",readWords:"readWords",readSentences:"readSentences",screenReader:"screenReader",prosodyRate:"prosodyRate",readerVoice:"readerVoice",dictionaries:"dictionaries","dictionaries\\.[^.]+":"dictionaries.dictionary","dictionaries\\.[^.]+\\.name":"dictionaries.dictionary.name","dictionaries\\.[^.]+\\.enabled":"dictionaries.dictionary.enabled",
"dictionaries\\.[^.]+\\.entries":"dictionaries.dictionary.entries","dictionaries\\.[^.]+\\.entries\\.entry":"dictionaries.dictionary.entries.entry",defaultErrorType:"defaultErrorTypes","defaultErrorTypes\\.[^.]+":"defaultErrorTypes.property",customErrorType:"customErrorTypes","customErrorTypes\\.[^.]+":"customErrorTypes.property",showDictionaryPredictions:"showDictionaryPredictions"},xa={createUserByEmail:!0,login:!0,logout:!0,getUserInfo:!0,forgotUsernameOrPassword:!0,validateSession:!0,usernameAvailable:!0},
ya={createProfile:!0,copyProfile:!0,getProfileSettings:!0,setProfileSettings:!0};
function O(a,c,b,d){var e="https://services."+l,f={},g={};if(xa[a])e+="/user/"+a;else if(ya[a])e+="/profile/"+a,c||(c={}),c.version=2;else{setTimeout(function(){var c={status:"error",errorCode:null,errorMessage:"Invalid action: '"+a+"'"};b&&b(c)},1);return}c&&(g.parameters=JSON.stringify(c));f["LingApps-Application"]="appwriter_cloud";f["LingApps-User-Session-ID"]=d?d:localStorage.sessionId;w(e,"POST",g,f,function(e){try{e=JSON.parse(e)}catch(g){console.log("userRequest ERROR",g,arguments,e);var f=
{status:"error",errorCode:null,errorMessage:g};b&&b(f);return}if("success"==e.status&&b)b(e);else if("error"==e.status)if("USER_SID_NOT_SET"==e.errorCode||"USER_SID_INVALID"==e.errorCode)if("google"==localStorage.sessionType){var H=e;za().then(function(e){"success"===e.status?O(a,c,b,d):(J(),b&&b(H))},function(){J();b&&b(H)})}else J(),b&&b(e);else b&&b(e)},function(){var a={status:"error",errorCode:"response",errorMessage:"HTTP error"};b&&b(a)})}
function Aa(a,c,b){return(new Promise(function(d){O("login",{username:a,password:c,remember:b},d)})).then(function(a){if("success"==a.status)return da(a.data,"normal").then(function(){return a});throw new x(a.errorCode,a.errorMessage);})}function K(a){O("logout",null,function(c){J();a&&a(c)})}function Ba(a){O("getUserInfo",null,function(c){a&&a(c)})}function Ca(a){O("validateSession",{sessionId:localStorage.sessionId},function(c){a&&a(c)})}
function Da(a,c,b){O("copyProfile",{name:a,product:"AppWriter Cloud",sourceProfile:c},function(a){b&&b(a)})}
function C(a,c){function b(){p?a&&p[a]?(r="selected",m=p[a],q=localStorage.currentProfileName=a):(r="unselected",m=void 0):(r="undefined",m=void 0);ja();G({action:"setProfile",profileStatus:r,currentProfileName:q,profile:m})}if(D&&F==I){if(!a||-1===E.settings.languages.indexOf(a)){var d=chrome.i18n.getMessage("@@ui_locale").replace(/\_/g,"-");void 0!==E.settings.languages[d]?a=d:(a=E.settings.languages[0],E.settings.languages.forEach(function(b){0===b.indexOf(d+"-")&&(a=b)}))}p[a]?(b(),c&&setTimeout(function(){c(!0)},
0)):Da(a,a,function(a){"success"==a.status||"PROFILE_PROFILE_EXISTS"==a.errorCode?B(!1,null,null,function(a){"success"==a.status?(p=a.data,b(),c&&c(!0)):c&&c(!1)}):c&&c(!1)})}else a=null,b(),c&&setTimeout(function(){c(!0)},0)}
function B(a,c,b,d){void 0===a&&(a=!0);O("getProfileSettings",{product:"AppWriter Cloud",compact:a,profile:c,property:b},function(e){if("success"==e.status)if(a&&(c||b))c&&!b?(void 0!==e.data.dictionaries.length&&(e.data.dictionaries={}),void 0!==e.data.defaultErrorTypes.length&&(e.data.defaultErrorTypes={}),void 0!==e.data.customErrorTypes.length&&(e.data.customErrorTypes={}),void 0===e.data.showDictionaryPredictions&&(e.data.showDictionaryPredictions=JSON.parse(localStorage.showDictionaryPredictions||
"false"))):c&&b&&b.match(/(dictionaries|defaultErrorTypes|customErrorTypes)/)&&void 0!==e.data.length&&(e.data={});else for(var f in e.data)e.data[f].dictionaries&&void 0!==e.data[f].dictionaries.length&&(e.data[f].dictionaries={}),e.data[f].defaultErrorTypes&&void 0!==e.data[f].defaultErrorTypes.length&&(e.data[f].defaultErrorTypes={}),e.data[f].customErrorTypes&&void 0!==e.data[f].customErrorTypes.length&&(e.data[f].customErrorTypes={}),void 0===e.data[f].showDictionaryPredictions&&(e.data[f].showDictionaryPredictions=
JSON.parse(localStorage.showDictionaryPredictions||"false"));d&&d(e)})}
function Ea(a,c,b,d,e){void 0===e&&(e=!0);var f=Fa(c);"object"==typeof b&&(b=null);O("setProfileSettings",{product:"AppWriter Cloud",settings:[{action:a,profile:q,prototype:f,property:c,value:b}]},function(a){"success"!=a.status||e?d&&d(a):B(!0,q,null,function(a){"success"==a.status&&(p[q]=a.data,m=p[q]);d&&d(a)})});if("showDictionaryPredictions"===c&&"update"===a){localStorage.showDictionaryPredictions=JSON.stringify(b);for(var g in p)p[g].showDictionaryPredictions=b}if(e){f=c.split(".");g=f.slice(-1)[0];
for(var h="entry"==g?!0:!1,k=m,n=0;n<f.length-1;n++)k=k[f[n]];if("create"==a)h?k.push(b):k[g]=b;else if("update"==a)k[g]=b;else if("delete"==a)if(h)for(n=0;n<k.length;n++){if(k[n]==b){k.splice(n,1);break}}else delete k[g];p[q]=m;"wordPredictions"==c&&ja()}}function Fa(a){for(var c in wa)if(a.match(new RegExp("^"+c+"$")))return wa[c];return!1}var L=!1,Ga=!1,P,Ha=!1,Ia=!1;function Ja(){Ga||(Ga=!0,Ka())}
function Ka(){function a(){"object"!==typeof La||"function"!==typeof za?Ga=!1:za().then(function(a){Ha=!0;if("success"===a.status)F===I?Ma():K();else return Ka()},function(){Ha=!0;return Ka()})}Ha?Ia||"normal"!==localStorage.sessionType?(clearInterval(P),L=!0,J()):localStorage.sessionId?Ca(function(a){"success"===a.status&&(Ia=!0,a.data?Ba(function(a){z(a.data.extraInfo.appwriterCloudLicense)==I?(y(a.data),Ma()):(clearInterval(P),L=!0,K())}):(clearInterval(P),L=!0,localStorage.sessionId=null,J()))}):
(clearInterval(P),Ia=L=!0,J()):"google"===localStorage.sessionType?K(a):a()}function Ma(){B(!1,null,null,function(a){"success"==a.status?(clearInterval(P),L=!0,p=a.data,p[q]?C(q):C()):(Ga=!1,K())})}Ja();P=setInterval(Ja,250);var Na={};
function Oa(a,c,b,d,e){var f="https://services."+l+"/"+a+"/"+c,g={},h={};b&&(h.parameters=JSON.stringify(b));g["LingApps-Application"]="appwriter_cloud";g["LingApps-User-Session-ID"]=e?e:localStorage.sessionId;w(f,"POST",h,g,function(g){try{g=JSON.parse(g)}catch(f){console.log("serviceRequest ERROR",f,arguments,g);var h={status:"error",errorCode:null,errorMessage:f};d&&d(h);return}if("success"==g.status&&d)d(g);else if("error"==g.status)if("USER_SID_NOT_SET"==g.errorCode||"USER_SID_INVALID"==g.errorCode)if("google"==
localStorage.sessionType){var M=g;za().then(function(g){"success"===g.status?Oa(a,c,b,d,e):(J(),d&&d(M))},function(){J();d&&d(M)})}else J(),d&&d(g);else d&&d(g)},function(){var a={status:"error",errorCode:"response",errorMessage:"HTTP error"};d&&d(a)})}
function Pa(a,c,b,d,e){Oa("prediction","getPredictions",{version:6,text:a,language:c,userDictionary:b,transforms:d,useCustomTransforms:!0},function(a){"USER_SID_NOT_SET"!=a.errorCode&&"USER_SID_INVALID"!=a.errorCode||alert(chrome.i18n.getMessage("predictionLoggedOutAlert"));e&&e(a)})}
function Qa(a,c,b,d,e,f,g,h){var k=[c,b,d,e,f,a].join("_");Na[k]&&!h?Ca(function(h){"success"==h.status&&h.data?g&&(h=JSON.parse(JSON.stringify(Na[k])),g(h)):Qa(a,c,b,d,e,f,g,!0)}):(h={text:a,voice:c,marks:b,prosodyRate:d,prosodyVolume:e,outputFormat:f},"undefined"!=typeof development&&(params.development=1),Oa("tts","synthesize",h,function(a){"success"==a.status?Na[k]=JSON.parse(JSON.stringify(a)):"USER_SID_NOT_SET"!=a.errorCode&&"USER_SID_INVALID"!=a.errorCode||alert(chrome.i18n.getMessage("readAloudLoggedOutAlert"));
g&&g(a)}))}var Q=null,Ra=null;chrome.windows.onRemoved.addListener(function(a){a==Q&&(Ra=Q=null)});
function Sa(a,c){"se-SE"===a&&(a="sv-SE");Ca(function(b){"success"==b.status&&b.data?(c=c.replace(/[\u200B]+/g,""),!c||/^\s*$/.test(c)?alert(chrome.i18n.getMessage("dictionaryEmptySelectionAlert")):1<c.split(/\s+/).length?alert(chrome.i18n.getMessage("dictionarySelectSingleWordAlert")):(b="https://services."+l+"/dictionary/lookup?application=appwriter_cloud&sessionId="+localStorage.sessionId+"&parameters="+JSON.stringify({language:a,word:c}),w("http://stats.appwriterlog.wizkids.dk/dictionary/lookup",
"POST",{data:JSON.stringify({data:{language:a,word:c,method:"direct"},time:Date.now()})},{"LingApps-User-Session-ID":localStorage.sessionId,"LingApps-Application":"appwriter_cloud"}),Q?(chrome.windows.update(Q,{focused:!0}),chrome.tabs.update(Ra,{url:b})):chrome.windows.create({type:"popup",focused:!0,url:b,left:Math.round(screen.width-450-300),top:Math.round(Math.max(0,(screen.height-800)/2)),width:450,height:800},function(a){Q=a.id;Ra=a.tabs[0].id}))):Ba(function(b){"success"==b.status?Sa(a,c):
alert(chrome.i18n.getMessage("dictionaryLoggedOutAlert"))})})};var Ta={};chrome.webRequest.onCompleted.addListener(function(a){if(D&&0!==a.url.indexOf("https://accounts.google.com/o/oauth2/")&&0!==a.url.indexOf("https://talkgadget.google.com/")&&/^https:\/\/[^.]+\.google(\.[a-z]{2,3})?\.[a-z]{2,4}(\/|$)/.test(a.url)){var c=a.url.match(/(\?|&)authuser=(\d+)/);c&&(c=c[2],Ta[c]||(console.log("Check drive access",a.url),ia(c)))}},{urls:["<all_urls>"]});chrome.webRequest.onHeadersReceived.addListener(function(){Ta={}},{urls:["*://accounts.google.com/Logout*"]});
chrome.runtime.onMessageExternal.addListener(function(a,c){if(!c.url||0===c.url.indexOf("https://services."+l+"/oauth/checkAuth")){var b=document.getElementById("check-auth-iframe");b&&b.parentNode.removeChild(b);"authorized"==a.gapiResult&&"offline"==a.type?Ua(a.sub,function(b){b||Va(a.authuser)}):"not-logged-in"!=a.gapiResult&&Va(a.authuser)}});
function ia(a){void 0===a&&(a=0);Ta[a]=D.username;var c=document.getElementById("check-auth-iframe");c&&c.parentNode.removeChild(c);c={extensionId:chrome.i18n.getMessage("@@extension_id"),oauthApplication:"appwriter",authuser:a,scope:["openid","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.install"]};a="https://services."+l+"/oauth/checkAuth?parameters="+encodeURIComponent(JSON.stringify(c));c=document.createElement("iframe");
c.id="check-auth-iframe";c.src=a;document.body.appendChild(c)}function Ua(a,c){var b="https://services."+l+"/oauth/validateAppWriterDriveAccess",d={parameters:JSON.stringify({sub:a})};w(b,"POST",d,{"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId},function(a){try{a=JSON.parse(a)}catch(b){c(!1);return}"success"==a.status?c(a.data):c(!1)})}
function Va(a){void 0===a&&(a="");a="https://services."+l+"/oauth/appWriterDriveAccess?application=appwriter_cloud&sessionId="+localStorage.sessionId+"&parameters="+encodeURIComponent(JSON.stringify({locale:v,authuser:a}));chrome.windows.create({type:"popup",focused:!0,url:a,left:Math.round((screen.width-450)/2),top:Math.round(Math.max(0,(screen.height-700)/2)),width:450,height:700})};function Wa(a,c){for(var b=[],d=0;d<a.length;d++)a[d].name===c&&b.push(a[d]);return b}function Xa(a){for(var c={},b=0;b<a.length;b++){var d=(a[b].value||"").split(";"),e=d[0].indexOf("=");c[d[0].substring(0,e)]=decodeURIComponent(d[0].substring(e+1))}return c}function Ya(a,c){this.type=a;this.detail=c}
var Za={id:"wizkids",path:btoa(("undefined"!=typeof DEVELOPMENT?"http":"https")+"://services."+l+"/user/unicLogin?application=appwriter_cloud"),auth:"undefined"!=typeof DEVELOPMENT?"28eb5aa26ab79899a4645550328b2a9d":"64fbb33a668cb13a962433438ad41992"},R=null,S=[],$a=[];function ab(){var a=[],c;for(c in Za)a.push(encodeURIComponent(c)+"="+encodeURIComponent(Za[c]));return"https://sso.emu.dk/unilogin/login.cgi?"+a.join("&")}
function bb(){return(new Promise(function(a,c){return w("https://sso.emu.dk/unilogin/login.cgi","GET",Za,null,a,c)})).then(function(a){return JSON.parse(a)}).then(null,function(a){return{status:"error",errorCode:"NOT_LOGGED_IN",errorMessage:a}}).then(function(a){var c=null,b=null;"success"===a.status?(c="logged-in",b=a.data):"NOT_LOGGED_IN"===a.errorCode?c="logged-out":(c="error",b=a.errorCode);return new Ya(c,b)})}
chrome.tabs.onRemoved.addListener(function(a){null!==S&&R===a&&(R=null,S[1](new x("USER_CANCEL","User closed the authentication window.")),S=null)});
chrome.webRequest.onHeadersReceived.addListener(function(a){var c=Wa(a.responseHeaders,"Set-Cookie"),c=Xa(c),b=null;if(c.response){b=c.response;try{b=JSON.parse(b)}catch(d){console.error(d)}}R===a.tabId&&(R=null,chrome.tabs.remove(a.tabId,function(){if(b)if("success"===b.status)S[0](b.data);else S[1](new x(b.errorCode,b.errorMessage));else S[1](new x("SERVER_PARSE_ERROR","Couldn't parse the response from the server."))}))},{urls:["https://services."+l+"/user/unicLogin?*"],types:["main_frame"]},["responseHeaders"]);function Wa(a,c){for(var b=[],d=0;d<a.length;d++)a[d].name===c&&b.push(a[d]);return b}function Xa(a){for(var c={},b=0;b<a.length;b++){var d=(a[b].value||"").split(";"),e=d[0].indexOf("=");c[d[0].substring(0,e)]=decodeURIComponent(d[0].substring(e+1))}return c}function cb(a,c){this.type=a;this.detail=c}var La={},T=null,U=[],db=[];
function eb(){return(new Promise(function(a,c){w("https://services."+l+"/user/getGoogleLoginUrl","GET",{locale:v},{"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId},a,c)})).then(function(a){return JSON.parse(a)}).then(function(a){return a.data})}function fb(){for(var a in La.b)La.b[a][1]("WINDOW_CLOSE")}
function gb(a){return hb(a).then(null,function(a){return{status:"error",errorCode:"NOT_LOGGED_IN",errorMessage:a}}).then(function(a){var b=null,d=null;"success"===a.status?(b="logged-in",d=a.data):"NOT_LOGGED_IN"===a.errorCode?b="logged-out":(b="error",d=a.errorCode);return new cb(b,d)})}
function ib(a){return(new Promise(function(c,b){w("https://services."+l+"/license/allowsGoogleLogin","GET",{parameters:JSON.stringify({email:a})},{"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId},c,b)})).then(function(a){return JSON.parse(a)}).then(function(a){if("success"!==a.status)throw new x(a.errorCode,a.errorMessage);a=a.data;if("LICENSE_GOOGLE_LOGIN_ALLOWED"!==a){var b="An unexpected error occurred.";"LICENSE_NO_LICENSE_FOR_DOMAIN"===a?b="There's no license for the user's domain.":
"LICENSE_LICENSE_DISABLED"===a?b="The user's license is disabled.":"LICENSE_LICENSE_EXPIRED"===a?b="The user's license has expired.":"LICENSE_MAX_USERS_REACHED"===a?b="The user's license has reached the maximum amount of users allowed.":"LICENSE_GOOGLE_LOGIN_NOT_ALLOWED"===a&&(b="The user's license doesn't allow the user to sign in with Google.");throw new x(a,b);}})}
function hb(a){return Promise.resolve().then(function(){return a?a:eb()}).then(function(a){return new Promise(function(b,d){w(a,"GET",null,null,b,d)})}).then(function(a){try{a=JSON.parse(a)}catch(b){throw new x("PARSE_SERVER_RESPONSE",a);}if("success"===a.status)return a;throw new x(a.errorCode,a.errorMessage);})}function za(a){return hb(a).then(function(a){localStorage.sessionType="google";localStorage.sessionId=a.data.sessionId;y(a.data.user);return a})}
chrome.tabs.onRemoved.addListener(function(a){null!==U&&T===a&&(T=null,U[1](new x("USER_CANCEL","User closed the authentication window.")),U=null)});
chrome.webRequest.onBeforeRequest.addListener(function(a){var c=a.url;return T===a.tabId?(T=null,chrome.tabs.remove(a.tabId,function(){return(new Promise(function(a,d){w(c,"GET",null,null,a,d)})).then(function(a){try{a=JSON.parse(a)}catch(c){throw new x("SERVER_PARSE_ERROR",a);}if("success"===a.status)return a;throw new x(a.errorCode,a.errorMessage);}).then(function(a){U[0](a.data)},function(a){U[1](a)})}),{cancel:!0}):{cancel:!1}},{urls:["https://services."+l+"/user/googleLogin/appwriter_cloud?*"],
types:["main_frame"]},["blocking"]);var E,F,A=0,ea=1,fa=2,ga=3,I=4;F=A;function z(a){return a?"disabled"==a.status||"disabled-customer"==a.status?ea:a.expired?fa:(a.settings.languages||[]).length?I:ga:A}function ha(){G({action:"setLicenseInfo",licenseInfo:E})};function kb(a){var c=chrome.runtime.connect();c.postMessage(a);c.disconnect()}var lb={},mb=0,V={},nb=0;function G(a){for(var c in V)V[c].postMessage(a)}function ob(a,c){for(var b in V)V.hasOwnProperty(b)&&void 0!==V[b].sender.tab&&V[b].sender.tab.id===a&&0===V[b].sender.frameId&&V[b].postMessage(c)}
chrome.runtime.onConnect.addListener(function(a){var c=++nb;V[c]=a;a.onDisconnect.addListener(function(){delete V[c]});a.onMessage.addListener(function(b){var c=b.messageId;void 0!==b.originalMessage&&(b=b.originalMessage);if(b&&b.action)switch(b.action){case "isPinned":W(a,u,c);break;case "setPinned":localStorage.setItem("IS_PINNED",JSON.stringify(u=b.pinned));u&&ba(null,null);G({action:"setPinned",pinned:u});W(null,c);break;case "setPredictionPopupPosition":ba(b.x,b.y);G({action:"setPredictionPopupPosition",
x:b.x,y:b.y});W(null,c);break;case "getPredictionPopupPosition":W(a,aa,c);break;case "isLoggedIn":W(a,{isLoggedIn:t},c);break;case "getLicenseInfo":W(a,{licenseInfo:E},c);break;case "getLicenseStatusses":W(a,{LICENSE_NO_LICENSE:A,LICENSE_DISABLED:ea,LICENSE_EXPIRED:fa,LICENSE_NO_LANGUAGUES:ga,LICENSE_VALID:I},c);break;case "validateLicense":W(a,z(b.licenseInfo),c);break;case "userLogin":Aa(b.username,b.password,b.remember).then(function(b){W(a,b,c)},function(b){W(a,b,c)});break;case "googleLoginAllowed":googleLoginAllowed(b.email,
function(b){W(a,b,c)});break;case "closeGoogleLoginWindow":fb();break;case "getProfile":W(a,{profileStatus:r,currentProfileName:q,profile:m},c);break;case "switchProfile":C(b.profileName,function(b){W(a,b,c)});break;case "updateProfile":Ea(b.profileAction,b.property,b.value);G({action:"setProfile",profileStatus:r,currentProfileName:q,profile:m});break;case "stats":b.data.time=Date.now();w("http://stats.appwriterlog.wizkids.dk/stats/insert","POST",{data:JSON.stringify(b.data)},{"LingApps-User-Session-ID":localStorage.sessionId,
"LingApps-Application":"appwriter_cloud"});break;case "getPredictions":Pa(b.text,b.language,b.dictionary,b.transforms,function(b){W(a,b,c)});break;case "synthesize":Qa(b.text,b.voice,b.marks,b.prosodyRate,b.prosodyVolume,b.outputFormat,function(b){W(a,b,c)});break;case "dictionaryLookup":Sa(b.language,b.word);break;case "stats_dictionaryLookup":localStorage.sessionId&&w("http://stats.appwriterlog.wizkids.dk/dictionary/lookup","POST",{data:JSON.stringify({data:{language:b.language,word:b.word,method:b.method},
time:Date.now()})},{"LingApps-User-Session-ID":localStorage.sessionId,"LingApps-Application":"appwriter_cloud"});break;case "googleLoggedIn":localStorage.sessionType="google";localStorage.sessionId=b.sessionId;B(!1,null,null,function(a){"success"==a.status?(y(b.user),p=a.data,C(p[q]?q:null),kb({action:"popupGoogleLoggedIn"})):(J(),kb({action:"unexpectedError",errorCode:a.errorCode}))});break;case "unicHeight":case "unicLogin":case "popupShowAjaxLoading":case "popupHideAjaxLoading":case "popupGoogleLoggedIn":break;
case "onedriveOpenFile":var e=b.fileId,f=b.serviceResourceId;Promise.resolve().then(function(){if(localStorage.ondriveSub)return pb(e,f).then(function(a){if("success"===a.status)return localStorage.ondriveSub},function(){})}).then(function(a){return a?a:qb(f).then(function(a){if("success"===a.status)return localStorage.ondriveSub=a.data.sub},function(){})}).then(function(a){f=f?"?serviceResourceId="+f:"";var b=encodeURIComponent(window.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,
"_"));a?(a=encodeURIComponent(window.btoa(unescape(encodeURIComponent(a))).replace(/\+/g,"-").replace(/\//g,"_")),chrome.tabs.create({url:"https://admin."+l+"/pdfviewer/onedrive/"+b+"/"+a+f})):chrome.tabs.create({url:"https://admin."+l+"/pdfviewer/onedrive/"+b+f})});break;case "captureVisibleTab":rb(a.sender.tab.windowId).then(function(b){W(a,b,c)},function(b){W(a,b,c)});break;case "cropReservedCapturedTab":sb(b.capturedTabId,b.x,b.y,b.width,b.height,b.devicePixelRatio).then(function(b){W(a,b,c)},
function(b){W(a,b,c)});break;case "ocrFile":tb(b.blobId,b.language).then(function(b){W(a,b,c)},function(b){W(a,b,c)});break;case "removeOcrFile":ub(b.fileId).then(function(b){W(a,b,c)},function(b){W(a,b,c)});break;case "getOcrFile":vb(b.fileId).then(function(b){W(a,b,c)},function(b){W(a,b,c)});break;default:console.log("Unknown message:",b)}else c&&(lb[c](b),delete lb[c])})});function wb(a){return a.sender.tab.id+"_"+a.sender.c}function xb(a){for(var c in V)if(a===wb(V[c]))return c;return null}
function yb(a,c,b){if(V[a]){var d=++mb;b&&(lb[d]=b);V[a].postMessage({originalMessage:c,messageId:d})}else b&&b()}function W(a,c,b){void 0===b?a.postMessage(c):a.postMessage({originalMessage:c,messageId:b})}var zb={},X={};
chrome.runtime.onConnectExternal.addListener(function(a){X[a.name]||(X[a.name]={});X[a.name][a.sender.tab.id]=a;var c=wb(a);a.onDisconnect.addListener(function(){for(var b in X){var c=X[b],e;for(e in c)if(e==a.sender.tab.id){delete X[b][e];break}}});a.onMessage.addListener(function(b){var d=b.messageId;void 0!==b.originalMessage&&(b=b.originalMessage);b&&b.action?"disablePredictions"==b.action?(b={action:"disablePredictions",hidePredictions:b.hidePredictions},yb(xb(c),b,function(){Ab(a,d)})):"enablePredictions"==
b.action&&(b={action:"enablePredictions",getPredictions:b.getPredictions},yb(xb(c),b,function(){Ab(a,d)})):d&&(zb[d](b),delete zb[d])})});function Ab(a,c){void 0===c?a.postMessage(null):a.postMessage({originalMessage:null,messageId:c})};window.sendContentScriptsMessage=G;window.userLogin=Aa;window.userLogout=K;window.adminLogout=function(){w("https://admin."+l+"/user/logout","GET");w("https://user."+l+"/user/logout","GET")};window.onLogin=y;
window.unicLogin=function(){var a=R=null;return bb().then(function(a){if("logged-in"===a.type)return a.detail;if("logged-out"===a.type)return new Promise(function(a,c){chrome.windows.create({type:"popup",focused:!0,url:ab(),left:Math.round((screen.width-450)/2),top:Math.round(Math.max(0,(screen.height-600)/2)),width:Math.round(450),height:Math.round(600)},function(e){R=e.tabs[0].id;S=[a,c]})});throw a.detail;}).then(function(c){a=c;return da(c,"uni-c")},function(a){S=null;if(null!==R)return(new Promise(function(a){chrome.tabs.remove(R,
function(){R=null;a()})})).then(function(){throw a;});throw a;}).then(null,function(c){var b=null;a&&(b=a.sessionId);return new Promise(function(a,e){O("logout",null,function(){J();e(c)},b)})}).then(function(){window.popupErrorMessage=null;for(var a=0;a<$a.length;a++)$a[a][0]()},function(a){window.popupErrorMessage=a;for(var b=0;b<$a.length;b++)$a[b][1](a);throw a;})};
window.googleLogin=function(){var a=T=null;return eb().then(function(a){return gb(a).then(function(b){if("logged-in"===b.type)return b.detail;if("logged-out"===b.type)return new Promise(function(b,e){chrome.windows.create({type:"popup",focused:!0,url:a,left:Math.round((screen.width-450)/2),top:Math.round(Math.max(0,(screen.height-600)/2)),width:Math.round(450),height:Math.round(600)},function(a){T=a.tabs[0].id;U=[b,e]})});throw b.detail;})}).then(function(c){a=c;return ib(c.user.email).then(function(){return da(c,
"google")})}).then(null,function(a){U=null;if(null!==T)return(new Promise(function(a){chrome.tabs.remove(T,function(){T=null;a()})})).then(function(){throw a;});throw a;}).then(null,function(c){var b=null;a&&(b=a.sessionId);return new Promise(function(a,e){O("logout",null,function(){J();e(c)},b)})}).then(function(){window.popupErrorMessage=null;for(var a=0;a<db.length;a++)db[a][0]()},function(a){window.popupErrorMessage=a;for(var b=0;b<db.length;b++)db[b][1](a);throw a;})};
window.googleLoginImmediate=hb;window.userCreateUserByEmail=function(a,c){O("createUserByEmail",{email:a,locale:v},function(a){c&&c(a)})};window.userForgotUsernameOrPassword=function(a,c){O("forgotUsernameOrPassword",{email:a,locale:v},function(a){c&&c(a)})};window.userSwitchProfile=C;window.userGetProfileSettings=B;window.userSetProfileSettings=Ea;window.updateProfile=function(){G({action:"setProfile",profileStatus:r,currentProfileName:q,profile:m})};window.getPredictions=Pa;window.synthesize=Qa;
window.isUsernameAvailable=function(a){return new Promise(function(c,b){O("usernameAvailable",{username:a},function(a){if("success"==a.status)c(!!a.data);else{var e=Error(a.errorMessage);e.name=a.errorCode;b(e)}})})};window.isSelectedPagePDF=function(){var a=oa[na];if(a in N)return"application/pdf"===N[a]||"x-pdf"===N[a];a=document.createElement("a");a.href=pa[na];a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(a.pathname);a.shift();a=a[3];console.log(a);return".pdf"===a};
window.setGoogleLoginTabId=function(a){googleLoginTabId=a};window.getCurrentProfileName=function(){return q};window.getLicenseInfo=function(){return E};window.getLicenseStatus=function(){return F};window.getUserInfo=function(){return D};window.getProfile=function(){return m};window.getProfileStatus=function(){return r};window.getProfiles=function(){return p};window.setProfiles=function(a){p=a};window.PREDICTION_LANGUAGES="da-DK de-DE en-GB en-US es-ES fr-FR it-IT nl-NL sv-SE".split(" ");
window.LICENSE_DISABLED=ea;window.LICENSE_EXPIRED=fa;window.LICENSE_INFO=E;window.LICENSE_NO_LICENSE=A;window.LICENSE_VALID=I;window.recordAudio=function(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){0!==a.length&&ob(a[0].id,{action:"recordAudio"})})};window.snipping=function(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){0!==a.length&&ob(a[0].id,{action:"snipping"})})};var Bb=450,Cb=600,Y=null,Z=null,Db="appwriter-cloud";
function pb(a,c){var b=localStorage.ondriveSub;return(new Promise(function(d,e){var f="https://services."+l+"/oauth/onedrive_getFileMetadata?application="+encodeURIComponent("appwriter_cloud")+"&sessionId="+encodeURIComponent(localStorage.sessionId)+"&sub="+encodeURIComponent(b)+"&resourceId="+encodeURIComponent(a);c&&(f+="&serviceResourceId="+encodeURIComponent(c));w(f,"GET",null,null,d,e)})).then(function(a){try{a=JSON.parse(a)}catch(b){return{status:"error",errorCode:"JSON_ERROR",errorMessage:b}}return a})}
function qb(a){if(null!==Z&&null!==Y){var c=Y;Y=null;chrome.tabs.remove(c,function(){});Z.reject("Closed by newer call.")}Z={};return(new Promise(function(b,c){var e="https://services."+l+"/oauth/onedrive_authenticate?identifier="+encodeURIComponent(Db)+"&application="+encodeURIComponent("appwriter_cloud")+"&sessionId="+encodeURIComponent(localStorage.sessionId);a&&(e+="&serviceResourceId="+encodeURIComponent(a));chrome.windows.create({type:"popup",focused:!0,url:e,left:Math.round((screen.width-Bb)/
2),top:Math.round(Math.max(0,(screen.height-Cb)/2)),width:Math.round(Bb),height:Math.round(Cb)},function(a){Y=a.tabs[0].id;Z.resolve=b;Z.reject=c})})).then(function(a){try{a=JSON.parse(a)}catch(c){return{status:"error",errorCode:"JSON_ERROR",errorMessage:c}}return a})}chrome.tabs.onRemoved.addListener(function(a){Y===a&&(Z.reject("Closed by user."),Z=null)});
chrome.webRequest.onBeforeRequest.addListener(function(a){return Y===a.tabId?(Y=null,chrome.tabs.remove(a.tabId,function(){w(a.url,"GET",null,null,Z.resolve,Z.reject)}),{cancel:!0}):{cancel:!1}},{urls:["https://services."+l+"/oauth/onedrive_validate?*"],types:["main_frame"]},["blocking"]);function tb(a,c){var b=new FormData;b.append("file",Eb[a]);delete Eb[a];var d="https://services."+l+"/ocr/ocrFile?parameters="+JSON.stringify({provider:"Google",exportFormat:"text",languages:[c]});return ca(d,b).then(function(a){return JSON.parse(a)})}
function ub(a){return new Promise(function(c){var b="https://services."+l+"/ocr/removeFile",d={parameters:JSON.stringify({fileId:a})};w(b,"GET",d,{"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId},function(){c()},function(a){c(a)})})}
function vb(a){return new Promise(function(c){var b="https://services."+l+"/ocr/getFile",d={parameters:JSON.stringify({fileId:a})};w(b,"GET",d,{"LingApps-Application":"appwriter_cloud","LingApps-User-Session-ID":localStorage.sessionId},function(a){c({status:200,response:a})},function(a){c({status:a,response:null})})})}
function rb(a){return(new Promise(function(c,b){try{chrome.tabs.captureVisibleTab(a,{format:"png"},function(a){a?c(a):b(chrome.runtime.lastError)})}catch(d){b(d)}})).then(function(a){var b=Fb++;Gb[b]=a;return b})}
function sb(a,c,b,d,e,f){var g=document.createElement("canvas");g.width=d;g.height=e;var h=g.getContext("2d"),k=1;1<f&&(k=1/f);1!==k&&(h.scale(k,k),c/=k,b/=k,d/=k,e/=k);var n=new Image;f=Gb[a];delete Gb[a];a=new Promise(function(a,b){n.onload=a;n.onerror=b});n.setAttribute("src",f);return a.then(function(){h.drawImage(n,c,b,d,e,0,0,d,e)}).then(function(){return new Promise(function(a,b){try{g.toBlob(function(b){a(b)},"image/png")}catch(c){b(c)}})}).then(function(a){var b=Hb++;Eb[b]=a;return b})}
var Fb=0,Gb={},Hb=0,Eb={};
