(function(e){function h(a,b,c){this.name=a;this.message=c;this.errorCode=b}function x(a){if(!a.hasAttribute("data-active"))return!0;var b=e.getCurrentProfileName();"se-SE"===b&&(b="sv-SE");return"phonetic-spelling"===a.getAttribute("data-active")?-1!==e.PREDICTION_LANGUAGES.indexOf(b):!0}function M(a){var b=e.getCurrentProfileName();switch(a.getAttribute("data-href")){case "phonetic-spelling":return"https://account.wizkids.dk/profile/aw/spelling/"+b}return null}function y(){e.getCurrentProfileName();
for(var a=document.querySelectorAll("a.link[data-href]"),b=0;b<a.length;b++)x(a[b])?(a[b].setAttribute("href",M(a[b])),a[b].classList.remove("link--disabled"),a[b].removeAttribute("disabled"),z(a[b]).disabled=!1):(a[b].classList.add("link--disabled"),a[b].removeAttribute("href"),a[b].setAttribute("disabled","true"),z(a[b]).disabled=!0)}function A(a,b){""===b.value?a.classList.add("mdc-textfield--empty"):a.classList.remove("mdc-textfield--empty")}function l(){var a=e.getProfile();a?document.getElementById("word-prediction-checkbox").checked=
!!a.wordPredictions:k("login");y()}function k(a){for(var b=document.querySelectorAll(".view"),c=0;c<b.length;c++)b[c].hidden=b[c].id!==a}function N(a,b,c){return Promise.resolve().then(function(){if(!a)throw new h("authentication","EMPTY_USERNAME","Username is not set.");if(!b)throw new h("authentication","EMPTY_PASSWORD","Password is not set.");}).then(function(){return e.userLogin(a,b,!!c)}).then(function(a){if("success"==a.status)return a.data;throw new h("authentication",a.errorCode,a.errorMessage);
}).then(null,function(b){if("USER_LOGIN_FAILED"===b.errorCode)return O(a).then(function(a){if(a)throw new h("authentication","USER_LOGIN_INCORRECT_PASSWORD","Password is incorrect.");throw new h("authentication","USER_LOGIN_INCORRECT_USERNAME","Username is incorrect.");});throw b;})}function O(a){return e.isUsernameAvailable(a).then(null,function(a){throw new h("isUsernameAvailable",a.name,a.message);})}function p(a){d.disabled=!a;c.disabled=!a;m.disabled=!a;P.disabled=!a;B.disabled=!a;C.disabled=
!a}function g(){D.style.display="";E.style.display="";F.style.display="";G.style.display="";H.style.display="";I.style.display="";J.style.display="";K.style.display="";L.style.display="";document.getElementById("other-login__error").textContent="";p(!0);for(var a=document.querySelectorAll(".mdc-textfield"),b=0;b<a.length;b++){var c=a[b].querySelector(".mdc-textfield__input");A(a[b],c)}}function q(a){switch(a.errorCode||a.name){case "EMPTY_USERNAME":d.setCustomValidity("Empty username.");D.style.display=
"block";d.focus();d.blur();d.focus();break;case "EMPTY_PASSWORD":c.setCustomValidity("Empty password.");J.style.display="block";c.focus();c.blur();c.focus();break;case "USER_LOGIN_INCORRECT_USERNAME":d.setCustomValidity("Incorrect username.");E.style.display="block";c.value="";d.focus();d.blur();c.focus();c.blur();d.focus();break;case "USER_LOGIN_INCORRECT_PASSWORD":c.setCustomValidity("Incorrect password.");K.style.display="block";c.value="";c.focus();c.blur();c.focus();break;case "USER_LOGIN_PASSWORD_EXPIRED":c.setCustomValidity("Expired password.");
L.style.display="";c.value="";c.focus();c.blur();c.focus();break;case "LICENSE_NO_LICENSE":d.setCustomValidity("No license."),F.style.display="block",c.value="",d.focus(),d.blur(),c.focus(),c.blur(),d.focus();case "LICENSE_DISABLED":d.setCustomValidity("License disabled."),G.style.display="block",c.value="",d.focus(),d.blur(),c.focus(),c.blur(),d.focus();case "LICENSE_EXPIRED":d.setCustomValidity("License expired."),H.style.display="block",c.value="",d.focus(),d.blur(),c.focus(),c.blur(),d.focus();
case "LICENSE_NO_LANGUAGUES":d.setCustomValidity("License has no languages."),I.style.display="block",c.value="",d.focus(),d.blur(),c.focus(),c.blur(),d.focus();case "LICENSE_NO_LICENSE_FOR_DOMAIN":document.getElementById("other-login__error").textContent=chrome.i18n.getMessage(a.name);break;default:document.getElementById("other-login__error").textContent=a.message,console.error(a)}}function z(a){for(var b=0;b<r.length;b++)if(a===r[b].element)return r[b].a;return null}h.prototype=function(a){function b(){}
b.prototype=a.prototype;return new b}(Error);var r=[],n=document.getElementById("login__form"),d=document.getElementById("username"),D=document.getElementById("username-helptext-empty"),E=document.getElementById("username-helptext-incorrect"),F=document.getElementById("username-helptext-license-no"),G=document.getElementById("username-helptext-license-disabled"),H=document.getElementById("username-helptext-license-expired"),I=document.getElementById("username-helptext-license-no-languages"),c=document.getElementById("password"),
J=document.getElementById("password-helptext-empty"),K=document.getElementById("password-helptext-incorrect"),L=document.getElementById("password-helptext-expired"),m=document.getElementById("remember-checkbox"),P=document.getElementById("login__submit"),B=document.getElementById("login__unic"),C=document.getElementById("login__google"),f=!1,u=new window.mdc.textfield.MDCTextfield(document.getElementById("username-mdc")),v=new window.mdc.textfield.MDCTextfield(document.getElementById("password-mdc"));
d.addEventListener("change",function(){d.setCustomValidity("")},!1);c.addEventListener("change",function(){c.setCustomValidity("")},!1);B.addEventListener("click",function(a){f||(a.preventDefault(),g(),p(!1),e.popupErrorMessage=null,f=!0,e.unicLogin().then(function(){d.value="";c.value="";m.checked=!1;u.getDefaultFoundation().deactivateFocus_();v.getDefaultFoundation().deactivateFocus_();k("menu");f=!1;g();e.popupErrorMessage=null}).then(function(){l()}).then(null,function(a){f=!1;g();q(a)}))},!1);
C.addEventListener("click",function(a){f||(a.preventDefault(),g(),e.popupErrorMessage=null,p(!1),f=!0,e.googleLogin().then(function(){d.value="";c.value="";m.checked=!1;u.getDefaultFoundation().deactivateFocus_();v.getDefaultFoundation().deactivateFocus_();k("menu");f=!1;g();e.popupErrorMessage=null}).then(function(){l()}).then(null,function(a){f=!1;g();q(a)}))},!1);n.addEventListener("submit",function(a){f||(a.preventDefault(),g(),e.popupErrorMessage=null,p(!1),f=!0,N(d.value,c.value,m.checked).then(function(){d.value=
"";c.value="";m.checked=!1;u.getDefaultFoundation().deactivateFocus_();v.getDefaultFoundation().deactivateFocus_();k("menu");f=!1;g();e.popupErrorMessage=null}).then(function(){l()}).then(null,function(a){console.error(a);f=!1;g();q(a)}))},!1);document.getElementById("word-prediction-checkbox").addEventListener("change",function(){e.userSetProfileSettings("update","wordPredictions",document.getElementById("word-prediction-checkbox").checked);e.updateProfile()},!1);for(var n=document.querySelectorAll("a.link"),
t=0;t<n.length;t++)n[t].addEventListener("click",function(a,b){b.preventDefault();x(a)&&chrome.tabs.create({url:a.getAttribute("href")})}.bind(null,n[t]),!1);document.getElementById("link-record-audio").addEventListener("click",function(a){a.preventDefault();e.recordAudio();window.close()},!1);document.getElementById("link-snipping").addEventListener("click",function(a){a.preventDefault();e.snipping();window.close()},!1);document.getElementById("logout").addEventListener("click",function(){e.userLogout();
k("login")},!1);(function(){for(var a=document.querySelectorAll("*"),b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.attributes.length;d++){var f=c.attributes[d],g=f.value.split(","),h=g[0],g=g.slice(1).map(function(a){switch(a){case "locale":return chrome.i18n.getMessage((e.getCurrentProfileName()||"").replace(/\-/g,"_"))}return null});"i18n"===f.name?c.textContent=chrome.i18n.getMessage(h,g):0===f.name.indexOf("i18n-")&&c.setAttribute(f.name.substring(5),chrome.i18n.getMessage(h,g))}})();(function(){for(var a=
document.querySelectorAll("#menu .mdc-list-item, .mdc-button"),b=0;b<a.length;b++)r.push({element:a[b],a:new window.mdc.ripple.MDCRipple(a[b])});a=document.querySelectorAll(".mdc-textfield");for(b=0;b<a.length;b++){var c=a[b].querySelector(".mdc-textfield__input"),d=A.bind(null,a[b],c);c.addEventListener("input",d,!1);d()}})();var w;try{w=!!e.getUserInfo()}catch(Q){w=!1}w?(k("menu"),document.getElementById("menu").hidden=!1,l()):k("login");y();chrome.extension.onConnect.addListener(function(a){a.onMessage.addListener(function(a){switch(a.action){case "setProfile":l()}})});
e.popupErrorMessage&&q(e.popupErrorMessage)}).call(this,chrome.extension.getBackgroundPage(),window.mdc);
