(function(){hubspot.define("sidekick.chrome.utils.console",["_","enviro","SignalsExtension/config/context"],function(e,t,n){var i;i=function(){function i(){this._assignMethods()}var o,r,s;s={log:0,debug:1,info:2,warn:3,error:4};r="SIDEKICK_FORCE_LOGGING";o=window.console||{};i._force=!1;i.prototype.forceLogging=function(e){this._force=e;localStorage[r]=e;return this._assignMethods()};i.prototype._assignMethods=function(){this.log=this._getLogFn("log",s.log);this.debug=this._getLogFn("debug",s.debug);this.info=this._getLogFn("info",s.info);this.warn=this._getLogFn("warn",s.warn);this.error=this._getLogFn("error",s.error)};i.prototype._getLogFn=function(t,n){var i;if(!this._shouldLog(t,n))return e.noop;i=o[t]||o.log||e.noop;return function(e){return function(){var t,n,o,r,s;n=new Array(arguments.length+1);n[0]="[Sidekick]";for(o=r=0,s=arguments.length;s>r;o=++r){t=arguments[o];n[o+1]=e._formatError(t)}return e._callLogFn(i,n)}}(this)};i.prototype._callLogFn=function(e,t){return e.apply(o,t)};i.prototype._shouldLog=function(e,t){return"background"===n?!0:this._force||"true"===localStorage[r]||this._aboveLevelThreshold(t)};i.prototype._aboveLevelThreshold=function(e){return t.deployed("console")?e>=s.error:e>=s.log};i.prototype._formatError=function(e){return e instanceof Error?e.stack?e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL?e.message+"\n"+e.sourceURL+":"+e.line:e:e};return i}();return new i})}).call(this);(function(){var e,t,n,i,o,r,s,a,u,c,l,d,p,h,f,g,m,b,k,v;n="PROD";h=!0;i="ENV";l=function(e){var t,n,i,o;return null!=(t=null!=(n=window[e])?n:null!=(i=window.sessionStorage)?i[e]:void 0)?t:null!=(o=window.localStorage)?o[e]:void 0};c=function(){var e;return(e=l(i))?e:n.toLowerCase()};v=function(e,t){return window[e]=t};e={prod:"production",qa:"development"};m=function(t){var n,i;return null!=(n=null!=(i=e[null!=t&&"function"==typeof t.toLowerCase?t.toLowerCase():void 0])?i:null!=t&&"function"==typeof t.toLowerCase?t.toLowerCase():void 0)?n:t};o=function(t){var n,i;t=null!=t&&"function"==typeof t.toLowerCase?t.toLowerCase():void 0;for(n in e){i=e[n];if(t===i)return n}return t};u=function(e,t){var n,i,o,r,s,a;n=null;if(e){s=e.split(".").reverse();for(i=0,o=s.length;o>i;i++){r=s[i];e=r.toUpperCase()+"_ENV";if(n=l(e))break}}null==n&&(n=null!=(a=null!=t?t:c())?a:"qa");return m(n)};b=function(e,t){if(1===arguments.length){t=e;e=i}return v(e,t)};d=function(e,t){return o(u(e,t))};p=d;f=function(e){return"prod"===p(e)};g=function(e){return"qa"===p(e)};r=function(e){var t,n;null==e&&(e="");return null!=(t=null!=(n=l(e.toUpperCase()+"_DEPLOYED"))?n:l("DEPLOYED"))?t:h};t=function(e,t){var n,i;null==t&&(t=!1);return null!=(n=null!=(i=l(e.toUpperCase()+"_DEBUG"))?i:l("DEBUG"))?n:t};k=function(e,t){var n;null==t&&(t=!0);if("string"==typeof e)try{t?localStorage.setItem(e.toUpperCase()+"_DEBUG",!0):localStorage.removeItem(e.toUpperCase()+"_DEBUG")}catch(i){n=i;v(e.toUpperCase()+"_DEBUG",t||void 0)}else{t=null!=e?e:!0;try{t?localStorage.setItem("DEBUG",t):localStorage.removeItem("DEBUG")}catch(i){n=i;v("DEBUG",t||void 0)}}};s=function(e,t){var n,i;null==t&&(t=!1);i=null!=(n=l(e.toUpperCase()+"_ENABLED"))?n:t;return"true"===(""+i).toLowerCase()};a={normalize:m,denormalize:o,get:u,getInternal:d,getShort:p,isProd:f,isQa:g,deployed:r,debug:t,setDebug:k,set:b,enabled:s};hubspot.define("enviro",[],function(){return a})}).call(this);(function(){hubspot.require(["enviro","Q"],function(e,t){return t.onerror=t.onunhandled=function(t){if("undefined"!=typeof console&&null!==console&&console.log&&console.groupCollapsed){console.groupCollapsed("%cQ Error","color: red");(null!=t?t.message:void 0)&&console.log(t.message);(null!=t?t.stack:void 0)&&console.log(t.stack);console.groupEnd()}e.deployed("raven")&&"undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(t)}})}).call(this);(function(){hubspot.define("sidekick.chrome.constants.bucky",["enviro","SignalsExtension/config/context"],function(e,t){var n,i,o,r,s,a,u,c,l,d;l=window.location.hostname;o="https://app.hubspot.com/bucky";c="sidekick.chrome";i={"mail.google.com":"gmail","inbox.google.com":"inbox"};r="background"===t?"background":"contentscript";s=i.hasOwnProperty(l);if(s){d=i[l];a=c+"."+r+"."+d}else a=c+"."+r;n=("background"===r||s)&&e.deployed("bucky");u=n&&window.self===window.top;return{BUCKY_SERVER:o,NAMESPACE:a,SEND_PAGE_PERF:u,ACTIVE:n}})}).call(this);(function(){hubspot.define("sidekick.chrome.constants.cookieDescriptors",[],function(){var e,t,n;t="_sign";n={prod:"getsidekick.com",qa:"getsidekickqa.com",local:"getsidekickqa.com"};e={prod:{domain:"."+n.prod,url:"https://"+n.prod},qa:{domain:"."+n.qa,url:"https://"+n.qa},local:{domain:"."+n.local,url:n.local}};return{SIDEKICK_COOKIE:e,SIDEKICK_COOKIE_NAME:t}})}).call(this);(function(){hubspot.define("sidekick.chrome.constants.matchers",[],function(){var e,t,n,i;t=/.*\/e1t\/[oc]\/.*\?.*(?:si=([0-9a-z]+).*&(?:amp;)?pi=[0-9a-z\-]+|pi=[0-9a-z\-]+.*&(?:amp;)?si=([0-9a-z]+))/i;e=/.*\/e1t\/[oc]\/.*\?.*(?:si=[0-9a-z]+.*&(?:amp;)?pi=([0-9a-z\-]+)|pi=([0-9a-z\-]+).*&(?:amp;)?si=[0-9a-z]+)/i;n=/.*\/e1t\/c\/.*\?.*t=([^\&]*)/i;i=/:\/\/[0-9a-z]+\.googleusercontent\.com\/proxy\//i;return{EVENT_TRACKER_SECONDARY_ID:t,EVENT_TRACKER_PRIMARY_ID:e,EVENT_TRACKER_TARGET:n,GOOGLE_CONTENT_PROXY:i}})}).call(this);(function(){hubspot.define("sidekick.chrome.constants.notifications.manager",[],function(){var e,t,n;n=4;e=32;t=72e5;return{NOTIFICATION_MAXLINES:n,MAX_LINE_LENGTH:e,MIN_AGE_OFFSET:t}})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.Bucky",["sidekick.chrome.constants.bucky","sidekick.chrome.bucky.eventsManager","sidekick.chrome.bucky.client","sidekick.chrome.bucky.memoryLogger","SignalsExtension/config/context"],function(e,t,n,i,o){var r,s;s=e.SEND_PAGE_PERF;if(s){n.get().sendPagePerformance("page");i.start()}r={};if("background"!==o){r.client=n;r.eventsManager=t}return r})}).call(this);(function(){hubspot.define("sidekick.chrome.bucky.client",["sidekick.chrome.constants.bucky","Bucky"],function(e,t){var n,i,o,r,s,a;i=e.BUCKY_SERVER,o=e.NAMESPACE,n=e.ACTIVE;t.setOptions({host:i,active:n,sample:.6});r=function(){var e;e=moment.duration(performance.now());return Math.floor(e.asHours())};s=_.once(function(){return t(o)});a=_.memoize(function(){var e;e=r();return t(o+"."+e+"h")},r);return{get:s,getWithProcessAge:a}})}).call(this);(function(){hubspot.define("sidekick.chrome.bucky.eventsManager",["sidekick.chrome.bucky.client"],function(e){var t,n,i;t="compose.new";n={newCompose:{isPending:!1,stopwatch:{}}};i={start:function(){var i;i=e.getWithProcessAge().timer;return n.newCompose={isPending:!0,stopwatch:i.stopwatch(t)}},mark:function(e){return n.newCompose.isPending===!0?n.newCompose.stopwatch.mark(e):void 0},done:function(){return n.newCompose.isPending=!1}};return{newCompose:i}})}).call(this);(function(){hubspot.define("sidekick.chrome.bucky.memoryLogger",["_","sidekick.chrome.bucky.client"],function(e,t){var n,i,o,r,s,a,u,c,l,d;o=6e4;i=60*o;n=15*o;l=0;d=function(){return e.delay(c,o)};c=function(){a();return setInterval(s,n)};a=function(){var e,n,i,o,s;i=t.getWithProcessAge().send;n=performance.memory,e=n.jsHeapSizeLimit,o=n.totalJSHeapSize,s=n.usedJSHeapSize;i("memory.limit",r(e));i("memory.total",r(o));i("memory.used",r(s));return u()};s=function(){var e;e=+new Date-l;return e>i?a():void 0};r=function(e){return e/1e3/1e3};u=function(){return l=+new Date};return{start:d}})}).call(this);(function(){hubspot.require(["sidekick.chrome.utils.console","SignalsExtension/config/context"],function(e,t){var n,i,o;n="https://mail.google.com/_/scs/mail-static";i=["InboxSDK Implementation Version"];o=[RegExp("chrome-extension://"+chrome.runtime.id)];return $(function(){var r,s;r={ignoreErrors:i,includePaths:o,dataCallback:function(e){var t;t=e.stacktrace;if(null==(null!=t?t.frames:void 0))return e;t.frames=_.reject(t.frames,function(e){var t;t=e.filename;return-1!==t.indexOf(n)});return e},release:chrome.runtime.getManifest().version};s="https://ca51b55e85514c39bb26d69b40c4621b@app.getsentry.com/20529";Raven.config(s,r).install();window.onerror=function(t){return function(){e.error.apply(e,arguments);return Raven.process.apply(t,arguments)}}(this);e.log("Raven initialized");return"background"===t?hubspot.require(["_","enviro","hubspot.HublyticsTrackerJS.SidekickTracker","SignalsExtension/data/salesGates"],function(t,n,i,o){chrome.runtime.onMessage.addListener(function(t,n,i){if("trackJsonAction"===t.method){trackJsonAction(t.action,t.props);e.debug("Tracking JSON Action "+t.action+" "+JSON.stringify(t.props));i({})}});return window.trackJsonAction=function(e,t){var o;null==t&&(t={});if(n.deployed("hublyticstrackerjs")){o=null!=t.what_extra_json||null!=t.what_event_subtype||null!=t.what_value_str?t:{what_extra_json:t};return i.trackInteraction(e,o)}}}):void 0})})}).call(this);(function(){hubspot.define("sidekick.chrome.blackBox",["Q","_","moment","enviro","sidekick.chrome.utils.sidekickApi","sidekick.chrome.backbone.models.user"],function(e,t,n,i,o,r){var s,a,u,c,l,d;s="SIGNALS_CHROME";a="fcc/v1/metrics/events";u=0;c={eventName:"BlackBox must be given an event name string",endpoint:"Failed to send event to BlackBox"};d=function(r){return function(r,d){var p,h,f;f=null!=d?d:{},p=f.appId,h=f.properties;return e.Promise(function(e,d){var f,g,m;if(!t.isString(r))return d(new Error(c.eventName));if(!i.deployed("blackbox"))return e();m=l();f={name:r,app_id:p||s,timestamp:n().valueOf()};null!=m&&(f.user_info=m);null!=h&&(f.properties=h);g={type:"POST",data:f,retries:u};t.defer(function(){return o.apiRequest(a,g).then(function(){return e()})["catch"](function(){return d(new Error(c.endpoint))})})})}}(this);l=function(e){return function(){return r.loggedIn()?{email:r.getVerifiedEmail(),user_id:r.getId(),properties:{created:r.getCreated().valueOf()}}:null}}(this);return{record:d}})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.http",["_","Q","jQuery"],function(e,t,n){var i,o,r;i={type:"GET",dataType:"json",retries:1,retryBackoff:5e3,retryType:"fixed",contentType:"application/json",processData:!0};r=function(r,s){null==s&&(s={});return t.Promise(function(t,a){var u,c,l,d;l=e.extend({},i,s,{url:r});"GET"===l.type||"application/json"!==l.contentType||null==l.data||e.isString(l.data&&l.processData)||(l.data=JSON.stringify(l.data));u=["retries","retryBackoff","retryType","retryIf"];d=e.omit(l,u);c=function(e){return n.ajax(d).then(t).fail(function(t){return function(t){var n,i,r,s,u;i=new Array(arguments.length);for(r=s=0,u=arguments.length;u>s;r=++s){n=arguments[r];i[r]=n}return o(l,t,e).then(function(t){return t?c(e+1):a.apply(null,i)})["catch"](a)}}(this))};return c(1)})};o=function(n,i,o){var r,s,a,u;a=n.retryIf,r=n.retries,s=n.retryBackoff,u=n.retryType;return e.isFunction(a)?t(a(i,o)):"linear"===u&&r>=o?t.delay(!0,s*o):r>=o?t.delay(!0,s):t(!1)};return{makeRequest:r}})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.sidekickApi",["Q","sidekick.chrome.utils.http","sidekick.chrome.backbone.models.user","urlinator/Url"],function(e,t,n,i){var o,r,s;o={auth:"Could not authorize user for Sidekick API"};r=function(e,n){var o;null==n&&(n={});o=new i("/"+e,{lb:"sidekick",protocol:"https"}).href;return s().then(function(){return t.makeRequest(o,n)})};s=function(){return e.Promise(function(e){return function(e,t){n.loggedIn()?e():t(new Error(o.auth))}}(this))};return{apiRequest:r,getAuth:s}})}).call(this);hubspot.define("SignalsExtension/data/salesGates",["_","sidekick.chrome.utils.console","sidekick.chrome.utils.sidekickApi","sidekick.chrome.common.utils.hubSpotApi"],function(e,t,n,i){"use strict";var o={},r=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(o,"__esModule",{value:!0});var s=r(t),a=r(n),u=r(i),c="gating/v1/sidekick/users/gates",l="Could not get gates for user",d=36e5,p=[],h=function(){return u.get().getPortalId()["catch"](function(){return null}).then(function(e){var t=e?"?portalId="+e:"";return a.apiRequest(""+c+t).then(function(e){p=e;s.log("User gates: ",p);return p})["catch"](function(){s.error(l);return p})})},f=e.throttle(h,d),g=function(){var e=void 0===arguments[0]?{throttle:!0}:arguments[0];return e.throttle?f():h()},m=function(t){return e.contains(p,t)};o={get:g,userUngatedFor:m};return o});(function(){hubspot.define("sidekick.chrome.utils.matchers",[],function(){var e;e=function(e){return RegExp("(?:si="+e+"&(?:amp;)?pi=([0-9A-z-]*)|pi=([0-9A-z-]*)&(?:amp;)?si="+e+")","i")};return{generatePixelMatcher:e}})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};hubspot.define("sidekick.chrome.utils.TrackerUtils",[],function(){var t;return t=function(){function t(){this.generateUUID=e(this.generateUUID,this);this.generateImgTag=e(this.generateImgTag,this);this.generateOpenTrackerURL=e(this.generateOpenTrackerURL,this)}var n,i;i="newtracker='true'";n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";t.prototype.generateOpenTrackerURL=function(e){var t,n,i;n=e.primaryId,i=e.secondaryId,t=e.domain;return t+"?si="+i+"&pi="+n};t.prototype.generateImgTag=function(e,t){var n;null==t&&(t=!1);n=t?i:"";return"<img src='"+e+"' "+n+"\n     style='display:none!important'\n     height='1'\n     width='1'>"};t.prototype.generateUUID=function(){var e,t,i;e=(new Date).getTime();t=function(t){var n;n=(e+16*Math.random())%16|0;e=Math.floor(e/16);return("x"===t?n:7&n|8).toString(16)};return i=n.replace(/[xy]/g,t)};return t}()})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},n={}.hasOwnProperty;hubspot.define("sidekick.chrome.backbone.models.extensionSync",["_","Backbone","SignalsExtension/background/backgroundMessaging","SignalsExtension/utils/contentScriptMessaging","SignalsExtension/config/context"],function(n,i,o,r,s){var a,u,c,l,d,p;l=n.partial;c=o.listenToContentScripts,p=o.sendToContentScripts;u=r.listenToBackground,d=r.sendToBackground;return a=function(n){function i(){this.sendMsg=e(this.sendMsg,this);this.sendAttributes=e(this.sendAttributes,this);this.eventChanged=e(this.eventChanged,this);this.listenForChanges=e(this.listenForChanges,this);this.init=e(this.init,this);return i.__super__.constructor.apply(this,arguments)}t(i,n);i.prototype.namespace=null;i.prototype.initialize=function(e,t,n){null==n&&(n=!1);this.namespace=t;this.on("change",this.eventChanged,this);if("content_script"===s){u(this.namespace+":init",l(this.listenForChanges,_,!1),this);u(this.namespace+":change",l(this.listenForChanges,_,!0),this);u(this.namespace+":add",l(this.listenForChanges,_,!0),this);d(this.namespace+":requestInit")}else"background"===s&&c(this.namespace+":requestInit",this.init,this)};i.prototype.init=function(){this.sendAttributes("init");return this};i.prototype.listenForChanges=function(e,t){this.set(e,{ext_sync:!0,merge:t});return this};i.prototype.eventChanged=function(e,t){"background"===s&&null==t.ext_sync&&this.sendAttributes("change")};i.prototype.sendAttributes=function(e){var t;t=this.toJSON();this.sendMsg(e,t);return this};i.prototype.sendMsg=function(e,t){var n;if("background"===s){n=this.namespace+":"+e;p(n,t)}return this};return i}(i.Model)})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.Track",[],function(){var e;e=function(){function e(){}e.prototype.error=function(e){var t,n,i;t=e.e,n=e.message,i=e.tags;if(null!=t){console.error(t);return Raven.captureException(t,{tags:i})}if(null!=n){console.error(n);return Raven.captureMessage(n,{tags:i})}throw new Error("Raven needs an error or a message")};return e}();return new e})}).call(this);(function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},t={}.hasOwnProperty,n=function(e,t){return function(){return e.apply(t,arguments)}};hubspot.define("sidekick.chrome.backbone.models.domainRotations",["SignalsExtension/utils/contentScriptMessaging","urlinator/Url"],function(t,i){var o,r,s;s=t.listenToBackground;r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var o;e(n,t);o="http://t.sidekickopen70.com/e1t";n.prototype.defaults={open:o+"/o/5/f18dQhb0S1Ll8dDMPbW2n0x6l2B9gXrW7sKj5C56dQtgf3ZlND602",click:o+"/c/5/f18dQhb0SmZ58dDMPbW2n0x6l2B9nMJW7sM9dn7dK_MMdBzM2-04"};n.prototype.url=new i("/signals/v1/clients/eventtracking/slug",{lb:"sidekick",protocol:"https"}).href;return n}(Backbone.Model);o=function(t){function o(){this.getSlugs=n(this.getSlugs,this);this.removeExistingTrackers=n(this.removeExistingTrackers,this);this.getAllDomains=n(this.getAllDomains,this);this.getDefaultDomains=n(this.getDefaultDomains,this);this.update=n(this.update,this);this.fetch=n(this.fetch,this);return o.__super__.constructor.apply(this,arguments)}e(o,t);o.prototype.url=new i("/signals/v1/clients/domain",{lb:"sidekick",protocol:"https"}).href;o.prototype.initialize=function(e,t){this.models={};this.models.slugs=new r;s("updateTrackingSlugs",this.update,this)};o.prototype.fetch=function(e){this.models.slugs.fetch();return o.__super__.fetch.call(this,e)};o.prototype.update=function(){this.fetch();this.trigger("updated");return this};o.prototype.getDefaultDomains=function(){return[]};o.prototype.getAllDomains=function(){return null!=this.get("all_domains")?this.get("all_domains"):this.getDefaultDomains()};o.prototype.removeExistingTrackers=function(e){var t,n,i,o,r,s;n=this.getAllDomains();r=function(e){return function(t){return function(){var n;n=RegExp("^.*"+e+"/link\\?url=([^&]*)&.*$");return t.href=t.href.replace(n,function(e,t){return decodeURIComponent(t)})}}(this)};s=[];for(i=0,o=n.length;o>i;i++){t=n[i];$('a[href*="'+t+'"]',e).attr("href",r(t));s.push($('img[src*="'+t+'"]',e).remove())}return s};o.prototype.getSlugs=function(){return{open:this.models.slugs.get("open"),click:this.models.slugs.get("click")}};return o}(Backbone.Model);return new o})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},n={}.hasOwnProperty;hubspot.define("sidekick.chrome.backbone.models.user",["_","sidekick.chrome.utils.http","sidekick.chrome.backbone.models.extensionSync","urlinator/Url"],function(n,i,o,r){var s;s=function(n){function o(){this.save=e(this.save,this);this.loggedIn=e(this.loggedIn,this);this.getCreated=e(this.getCreated,this);this.getVerifiedEmail=e(this.getVerifiedEmail,this);this.getBCCEmail=e(this.getBCCEmail,this);this.getId=e(this.getId,this);this.getKey=e(this.getKey,this);this.isPro=e(this.isPro,this);return o.__super__.constructor.apply(this,arguments)}t(o,n);o.prototype.url=function(){return new r("/user/validate-session",{lb:"sidekickapp",protocol:"https"}).href};o.prototype.initialize=function(e){null!=e&&(this.initialized=e.initialized);o.__super__.initialize.call(this,e,"userprofile")};o.prototype.isPro=function(){return this.get("is_pro")};o.prototype.getKey=function(){return this.get("key")};o.prototype.getId=function(){return this.get("id")};o.prototype.getBCCEmail=function(){var e;e=this.get("bcc_crm_email");return""===e||null==e?null:e};o.prototype.getVerifiedEmail=function(){return this.get("verified_email")};o.prototype.getCreated=function(){var e;e=this.get("created");return null==e?null:moment(e)};o.prototype.loggedIn=function(){return null!=this.getKey()&&this.getKey()!==!1};o.prototype.getTrackingProperties=function(){return{distinct_id:this.get("key"),email:this.get("verified_email"),id:this.get("id"),pro_authorized:this.get("pro_authorized"),registered_date:this.getCreated().valueOf()}};o.prototype.save=function(){return Q.Promise(function(e){return function(t,n){var o,s;if(e.loggedIn()){s=new r("/user",{lb:"sidekickapp",protocol:"https"}).href;o={type:"PUT",data:e.toJSON()};return i.makeRequest(s,o).then(function(t){return e.set(t)}).then(t)}return n(new Error("Cannot save user when not logged in"))}}(this))};return o}(o);return new s})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},n={}.hasOwnProperty;hubspot.define("sidekick.chrome.backbone.models.options",["_","Backbone","sidekick.chrome.backbone.models.user"],function(n,i,o){var r;r=function(n){function i(){this.setNotifications=e(this.setNotifications,this);this.setAlarmStatus=e(this.setAlarmStatus,this);this.getNotifications=e(this.getNotifications,this);this.getBCC=e(this.getBCC,this);this.getAlarmStatus=e(this.getAlarmStatus,this);this.hasAlarm=e(this.hasAlarm,this);this.hasSelfOpens=e(this.hasSelfOpens,this);return i.__super__.constructor.apply(this,arguments)}t(i,n);i.prototype.hasSelfOpens=function(){return o.get("has_self_opens")};i.prototype.hasAlarm=function(){var e;e=this.getAlarmStatus();return null!=e&&""!==e};i.prototype.getAlarmStatus=function(){return this.get("alarm_status")};i.prototype.getBCC=function(){return"true"===localStorage.defaultBCC};i.prototype.getNotifications=function(){return this.get("notifications")||0};i.prototype.setAlarmStatus=function(e){this.set("alarm_status",e);return this};i.prototype.setNotifications=function(e){this.set("notifications",e);return this};return i}(i.Model);return new r})}).call(this);(function(){window.hublytics={eventClasses:{USAGE:"USAGE",WARNING:"WARNING",ERROR:"ERROR",INTERACTION:"INTERACTION",VIEW:"VIEW",ACTIVATION:"ACTIVATION",SIGNUP:"SIGNUP",EXPOSURE:"EXPOSURE",CREATION:"CREATION",NONE:"NONE"},selectorify:function(e){var t,n;t=function(e,n){var i,o,r;r="";i=e.id;if(i){r+="#"+e.id;n.unshift(r);return n}r+=e.tagName.toLowerCase();e.classList.length&&(r+="."+Array.prototype.join.call(e.classList,"."));n.unshift(r);o=e.parentElement;return o&&1===o.nodeType?t(o,n):n};if(!e&&1!==e.nodeType)throw new TypeError("Node is not an element");n=t(e,[]);return n.join(" > ")},isObject:function(e){var t;t=typeof e;return"function"===t||"object"===t&&!!e},extend:function(e){var t,n,i,o;if(!hublytics.isObject(e))return e;o=void 0;i=void 0;t=1;n=arguments.length;for(;n>t;){o=arguments[t];for(i in o)hasOwnProperty.call(o,i)&&(e[i]=o[i]);t++}return e},trim:function(e){return"function"!=typeof String.prototype.trim?e.replace(/^\s+|\s+$/g,""):e.trim()},getCookie:function(e){var t,n,i,o,r;n=null;if(document.cookie&&""!==document.cookie){i=document.cookie.split(";");for(o=0,r=i.length;r>o;o++){t=i[o];t=hublytics.trim(t);if(t.substring(0,e.length+1)===e+"="){n=t.substring(e.length+1);return n}}}},setCookie:function(e,t,n){var i,o;null==n&&(n=5184e6);i=new Date;i.setTime(i.getTime()+n);o=i.toGMTString();return document.cookie=e+"="+t+";expires="+o+";path=/"},deleteCookie:function(e){return document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"},getStorage:function(e){var t;try{t=window.localStorage.getItem(e);if(t)return JSON.parse(t)}catch(n){t=hublytics.getCookie(e);if(t)return JSON.parse(decodeURIComponent(t))}},setStorage:function(e,t){var n;try{return window.localStorage.setItem(e,JSON.stringify(t))}catch(i){return n=hublytics.setCookie(e,encodeURIComponent(JSON.stringify(t)))}},clearStorage:function(e){try{return window.localStorage.removeItem(e)}catch(t){return hublytics.deleteCookie(e)}},LOG_PREFIX:"[HublyticsTrackerJS]",log:function(){var e;try{if("true"===window.localStorage.HUBLYTICS_DEBUG){e=Array.prototype.slice.apply(arguments);e.unshift(this.LOG_PREFIX);return console.log.apply(console,e)}}catch(t){}},warn:function(){var e;try{if("true"===window.localStorage.HUBLYTICS_DEBUG){e=Array.prototype.slice.apply(arguments);e.unshift(this.LOG_PREFIX);return console.warn.apply(console,e)}}catch(t){}},error:function(){var e;e=Array.prototype.slice.apply(arguments);e.unshift(this.LOG_PREFIX);return console.error.apply(console,e)},getBaseDomain:function(){var e,t;t=window.location.host.split(".");e=t.slice(t.length-2);return e.join(".")},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t,n;t=16*Math.random()|0;n="x"===e?t:3&t|8;return n.toString(16)})},getValidLocaleString:function(){return window.navigator?window.navigator.language||window.navigator.userLanguage||void 0:void 0}};"undefined"!=typeof hubspot&&hubspot.define&&hubspot.define("hubspot.HublyticsTrackerJS.utils",[],function(){return window.hublytics})}).call(this);(function(){var e,t,n,i,o,r,s,a,u,c,l,d,p,h,f,g,m,b,k,v=[].slice;i=hublytics.eventClasses;k=hublytics.selectorify,h=hublytics.extend,f=hublytics.getBaseDomain,g=hublytics.getCookie,b=hublytics.makeUuid,m=hublytics.getValidLocaleString;s="hublytics/ingester/event";a="usage-logging/v1/log/hublytics-multi/no-auth";l="pageview";n=5e3;r=8e3;p="HUBLYTICS_EVENTS_";o="__hmpl";d=18e5;e={generic:{qa:"api.hubapiqa.com",prod:"api.hubapi.com"},hubteam:{qa:"tools.hubteamqa.com",prod:"tools.hubteam.com"},hubspot:{qa:"app.hubspotqa.com",prod:"app.hubspot.com"},sidekick:{qa:"api.getsidekickqa.com",prod:"api.getsidekick.com"}};t={"hubteamqa.com":"hubteam","hubteam.com":"hubteam","hubspotqa.com":"hubspot","hubspot.com":"hubspot","getsidekickqa.com":"sidekick","getsidekick.com":"sidekick"};c={name:"signals_extension_modified_HublyticsTrackerJS",version:2};null==window._hsq&&(window._hsq=[]);u=function(){function s(){var i;setTimeout(function(e){return function(){e.inBatchPeriod=!1;return e.tryFlush()}}(this),n);i=t[f()];if(i)this.apiInfo=e[i];else{this.apiInfo=e.generic;hublytics.log("Hublytics on an unknown domain.")}}s.prototype.EVENT_CLASSES=i;s.prototype.eventsLog=[];s.prototype.eventsQueue=[];s.prototype.callbackQueue=[];s.prototype.inBatchPeriod=!0;s.prototype.isExternal=!1;s.prototype.init=function(){return this._initialize.apply(this,arguments)};s.prototype._initialize=function(e){null==e&&(e={});this.accountId=e.accountId,this.env=e.env,this.app=e.app,this.userIdentifier=e.userIdentifier,this.teamIdentifier=e.teamIdentifier,this.email=e.email,this.isExternal=e.isExternal,this.batchRequests=e.batchRequests,this.everyEventProperties=e.everyEventProperties,this.who_identifier_v2=e.who_identifier_v2;this.batchRequests===!1&&(this.inBatchPeriod=!1);this.everyEventProperties&&(this.everyEventProperties=this.flattenData(this.everyEventProperties));null!=e.isExternal&&(this.isExternal=e.isExternal);null==this.env&&(this.env="prod");this.isExternal&&this.hstcCallback();this.eventsQueue=this.eventsQueue.concat(this.getSavedEvents());return this._validateInitialization()?hublytics.log("Initialized w/ accountId: "+this.accountId+", app: "+this.app):void 0};s.prototype._validateInitialization=function(){var e,t;t=[];this.isExternal||this.who_identifier_v2||this.email||hublytics.error("Apps that are not external (isExternal=false) need an email or who_identifier_v2 passed in to init() in order to create the who_identifier_v2.");if(t.length){if(console.group){e="HublyticsTrackerJS Initialization Errors";console.group(e);hublytics.log(data);t.forEach(function(e){return hublytics.error(e)});"function"==typeof console.groupEnd&&console.groupEnd(e)}else t.forEach(function(e){return hublytics.error(e)});return!1}return!0};s.prototype._getHamplitudeValues=function(){var e,t;t=hublytics.getStorage(o);e=+new Date;if(t)this.hamplitudeValues=t;else{this.hamplitudeValues={device_id:b(),last_event_id:0,last_sequence_number:0,last_timestamp_checked_against_session:e,session_id:+new Date};hublytics.setStorage(o,this.hamplitudeValues)}e-this.hamplitudeValues.last_timestamp_checked_against_session>d&&this._updateHamplitudeValues({last_event_id:0,session_id:e});return this.hamplitudeValues};s.prototype._updateHamplitudeValues=function(e){this.hamplitudeValues=h({},this.hamplitudeValues,e);hublytics.setStorage(o,this.hamplitudeValues);return this.hamplitudeValues};s.prototype.hstcCallback=function(){var e;window._hsq.push(function(e){return function(){return e.tryFlush()}}(this));e="hstc-not-set";return setTimeout(function(t){return function(){var n;if(!window._hstc_ran){hublytics.error("_hstc_ran=false after "+r+"ms, will try to send "+e+" event to hublytics. It may get set after the timeout in which case events in the queue will get flushed and sent properly. See https://git.hubteam.com/HubSpot/HublyticsTrackerJS/blob/master/README.md#hubspot-tracking-code-integration.");n={hublytics_account_id:t.accountId,where_app:t.app,where_screen:t.screen||"hstc-error",where_subscreen:t.subscreen,who_identifier:t.userIdentifier,who_team_identifier:t.teamIdentifier,who_email:t.email,what_event:e,what_event_class:i.ERROR,when_timestamp:(new Date).getTime(),library:c};return t.actualFlush([n])}}}(this),r)};s.prototype.trackAppScreen=function(e,t,n,i,o){null==i&&(i={});null==o&&(o={});this.app=e;this.screen=t;this.subscreen=n;return this.trackView(i,o)};s.prototype.trackScreen=function(e,t,n,i){null==n&&(n={});null==i&&(i={});this.screen=e;this.subscreen=t;return this.trackView(n,i)};s.prototype.trackSubscreen=function(e,t,n){null==t&&(t={});null==n&&(n={});this.subscreen=e;return this.trackView(t,n)};s.prototype.trackView=function(e,t){null==e&&(e={});null==t&&(t={});return this._track(h({what_event:l,what_event_class:i.VIEW},e),t)};s.prototype.trackCreation=function(){return this.trackEventWithClass.apply(this,[i.CREATION].concat(v.call(arguments)))};s.prototype.trackInteraction=function(){return this.trackEventWithClass.apply(this,[i.INTERACTION].concat(v.call(arguments)))};s.prototype.trackActivation=function(){return this.trackEventWithClass.apply(this,[i.ACTIVATION].concat(v.call(arguments)))};s.prototype.trackSignup=function(){return this.trackEventWithClass.apply(this,[i.SIGNUP].concat(v.call(arguments)))};s.prototype.trackExposure=function(){return this.trackEventWithClass.apply(this,[i.EXPOSURE].concat(v.call(arguments)))};s.prototype.trackUsage=function(){return this.trackEventWithClass.apply(this,[i.USAGE].concat(v.call(arguments)))};s.prototype.trackWarning=function(){return this.trackEventWithClass.apply(this,[i.WARNING].concat(v.call(arguments)))};s.prototype.trackError=function(){return this.trackEventWithClass.apply(this,[i.ERROR].concat(v.call(arguments)))};s.prototype.trackEventWithClass=function(e,t,n,i){var o;null==n&&(n={});null==i&&(i={});o=h({},n.what,{event:t,event_class:e});n=h({},n,{what:o});return this._track(n,i)};s.prototype.clearSubscreen=function(){return delete this.subscreen};s.prototype.flattenData=function(e){var t,n,i,o,r,s,a,u,c,l;t={};a=Object.keys(e);for(n=0,r=a.length;r>n;n++){c=a[n];if("what"===c||"who"===c||"where"===c||"how"===c){l=e[c];u=Object.keys(l);for(i=0,s=u.length;s>i;i++){o=u[i];t[c+"_"+o]=l[o]}}else t[c]=e[c]}return t};s.prototype.track=function(e,t){null==e&&(e={});null==t&&(t={});return this._track(e,t)};s.prototype._track=function(e,t){var n,i,o,r,s,a,u,l,d;null==e&&(e={});null==t&&(t={});e=this.flattenData(e);if(this.everyEventProperties){s=Object.keys(this.everyEventProperties);for(i=0,r=s.length;r>i;i++){o=s[i];e[o]=h({},e[o],this.everyEventProperties[o])}}t.element&&!e.what_dom&&(e.what_dom=k(t.element));d=e.where_app_override;d&&!e.what_variation&&(e.what_variation=this.app);try{delete e.where_app_override}catch(p){}"qa"===this.env&&d&&hublytics.log('where_app was overridden using where_app_override for event "'+e.what_event+'"');n=this._getHamplitudeValues();u=n.last_event_id+1;l=n.last_sequence_number+1;a={device_id:n.device_id,event_id:u,session_id:n.session_id,sequence_number:l,language:hublytics.getValidLocaleString()};this._updateHamplitudeValues({last_event_id:u,last_sequence_number:l,last_timestamp_checked_against_session:+new Date});e=h({},{hublytics_account_id:this.accountId,where_app:d||this.app,where_screen:this.screen,where_subscreen:this.subscreen,who_identifier_v2:this.who_identifier_v2||"[NOT YET SET, SHOULD GET SET PRIOR TO FLUSH]",
who_team_identifier:this.teamIdentifier,when_timestamp:(new Date).getTime(),library:c},a,e);e=this.transformData(e);return this._validateEvent(e)?this.considerSending(e,t):void 0};s.prototype.transformData=function(e){var t;t=e.what_extra_json;t&&"object"==typeof t&&(e.what_extra_json=JSON.stringify(t));return e};s.prototype._validateEvent=function(e){var t,n;n=[];null==e.hublytics_account_id&&n.push("Missing property: hublyticsAccountId. Did you call init()?");null==e.where_app&&n.push("Missing property: where.app/where_app Did you call init()?");null==e.where_screen&&n.push("Missing property: where.screen/where_screen. Did you call trackScreen()?");null==e.what_event_class&&n.push("Missing property: what.event_class/what_event_class.");this.isExternal||null==e.who_team_identifier&&n.push("Missing property: who.teamIdentifier/who_team_identifier");if(n.length){if(console.group){t="HublyticsTrackerJS Errors";console.group(t);hublytics.log(e);n.forEach(function(e){return hublytics.error(e)});"function"==typeof console.groupEnd&&console.groupEnd(t)}else n.forEach(function(e){return hublytics.error(e)});return!1}return!0};s.prototype.considerSending=function(e,t){null==t&&(t={});this.eventsQueue.push(e);this.saveEvent(e);t.callback&&this.callbackQueue.push(t.callback);return this.tryFlush()};s.prototype.setWhoIdentifierV2=function(e){var t,n;n=function(t){return function(){var n,i,o,r;if(t.who_identifier_v2){r=t.eventsQueue;for(i=0,o=r.length;o>i;i++){n=r[i];n.who_identifier_v2=t.who_identifier_v2}}return e()}}(this);if(this.who_identifier_v2)return n();if(this.isExternal){t="__hstc";return chrome.cookies.get({url:"https://hubspot.com",name:t},function(e){return function(i){var o,r;o=null!=i?i.value:void 0;if(o){r=o.split(".")[1];e.who_identifier_v2="VISITOR:::"+r+":::"+e.accountId}else{hublytics.error("Couldn't find "+t+" cookie even though _hstc_ran=true");e.immediatelyTrackHublyticsError("hstc-cookie-not-found")}return n()}}(this))}this.who_identifier_v2="EMAIL:::"+this.email+":::"+this.accountId;return n()};s.prototype.immediatelyTrackHublyticsError=function(e){var t;t={hublytics_account_id:this.accountId,where_app:this.app,where_screen:this.screen||"hstc-cookie-error",where_subscreen:this.subscreen,who_identifier:this.userIdentifier,who_team_identifier:this.teamIdentifier,who_email:this.email,what_event:e,what_event_class:i.ERROR,when_timestamp:(new Date).getTime(),library:c};return this.actualFlush([t])};s.prototype.canFlush=function(){return!this.inBatchPeriod&&(!this.isExternal||this.isExternal&&window._hstc_ran)};s.prototype.tryFlush=function(){return this.canFlush()&&this.eventsQueue.length?this.setWhoIdentifierV2(function(e){return function(){e.actualFlush(e.eventsQueue,e.callbackQueue);e.eventsQueue=[];return e.callbackQueue=[]}}(this)):void 0};s.prototype.actualFlush=function(e,t){var n,i,o,r;null==t&&(t=[]);if(this.who_identifier_v2){hublytics.log("Sending events:");for(i=0,o=e.length;o>i;i++){n=e[i];hublytics.log(n)}r=new XMLHttpRequest;r.open("POST",this.getTrackingURL(),!0);r.setRequestHeader("Content-Type","application/json; charset=UTF-8");r.onreadystatechange=function(e){return function(){var n,i,o,s;if(4===r.readyState){r.status>=200&&r.status<300&&e.clearSavedEvents();s=[];for(i=0,o=t.length;o>i;i++){n=t[i];s.push(n())}return s}}}(this);r.send(JSON.stringify(e));return this.eventsLog=this.eventsLog.concat(e)}};s.prototype.saveEvent=function(e){var t;t=this.getSavedEvents();t.push(e);return hublytics.setStorage(this.getEventsStorageKey(),t)};s.prototype.clearSavedEvents=function(){return hublytics.clearStorage(this.getEventsStorageKey())};s.prototype.getSavedEvents=function(){return hublytics.getStorage(this.getEventsStorageKey())||[]};s.prototype.getEventsStorageKey=function(){return p+this.accountId};s.prototype.getTrackingURL=function(){var e,t;t="?clientSendTimestamp="+(new Date).getTime();e=this.apiInfo[this.env];return e?"https://"+e+"/"+a+t:hublytics.error("Unknown env: "+this.env)};s.prototype.printEventsLog=function(){var e;e="All hublytics events during this session";console.group(e);console.log("--- As a table ---");console.table(this.eventsLog);console.log("--- As an array ---");console.log(this.eventsLog);return console.groupEnd(e)};s.prototype.printState=function(){var e,t,n,i,o;o=["app","screen","subscreen","subscreen2","accountId","env","userIdentifier","teamIdentifier","email","isExternal"];e="State of the HublyticsTracker";console.group(e);for(t=0,n=o.length;n>t;t++){i=o[t];hublytics.log(i+": "+this[i])}return console.groupEnd(e)};return s}();window.HublyticsTracker=new u;"undefined"!=typeof hubspot&&hubspot.define&&hubspot.define("hubspot.HublyticsTrackerJS.tracker",["hubspot.HublyticsTrackerJS.utils"],function(e){return window.HublyticsTracker})}).call(this);(function(){hubspot.define("hubspot.HublyticsTrackerJS.SidekickTracker",["hubspot.HublyticsTrackerJS.tracker","enviro","SignalsExtension/config/context"],function(e,t,n){var i;i=e;i.init=function(e,i){var o,r,s,a,u,c;null==i&&(i={});window._hstc_ran=!0;if("background"===n){s=t.getShort("hublyticstrackerjs");r=i.email;a=null==r;o=53;c=0;if(!e){u="Error: App is not set in init().";console.group?console.group(u):hublytics.error(u);hublytics.log("app: "+e);"function"==typeof console.groupEnd&&console.groupEnd(u)}this.who_identifier_v2=null;this.email=null;this.isExternal=null;return this._initialize({accountId:o,app:e,env:s,teamIdentifier:c,email:r,isExternal:a})}};i.hasEmail=function(){return!this.isExternal&&null!=this.email};return i})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};hubspot.define("sidekick.chrome.common.utils.hubSpotApi",["_","Q","jQuery","enviro","urlinator/Url"],function(n,i,o,r,s){var a;a=function(){function r(){this.setStoredToken=e(this.setStoredToken,this);this.getPortalId=e(this.getPortalId,this);this.getScopes=e(this.getScopes,this)}r.prototype.apiRequest=function(e,t){var r,a,u,c,l,d,p;c={haveForced:!1};a={type:"GET",contentType:"application/json",dataType:"json",processData:!0,traditional:!0};d=n.extend({},a,t);e=new s("/"+e,{lb:"api",protocol:"https"}).href;p=d.success;u=d.error;r=d.complete;delete d.success;delete d.error;delete d.complete;l=function(t){return function(n){var r,s;s=t.buildXhrConnectionOptions(e,n,d);r=i(o.ajax(s));null!=p&&r.then(p);return r.then(null,function(e,n,o){if(401===e.status)return t.buildAuthSigning(c,!0).then(l);null!=u&&u();return i.reject(e)})}}(this);return this.buildAuthSigning(c).then(l)};r.prototype.hasScopes=function(e){return this.getScopes().then(function(t){return n.intersection(e,t).length===e.length},function(e){return!1})};r.prototype.getScopes=function(){var e;e={haveForced:!1};return this.getStoredToken().then(function(t){return function(n){return n.expires>=(new Date).getTime()&&n.hasOwnProperty("scopes")?n.scopes:t.refreshAuthToken(e,!0).then(t.getScopes)}}(this),function(t){return function(n){return t.refreshAuthToken(e,!0).then(t.getScopes)}}(this))};r.prototype.getPortalId=function(){var e;e={haveForced:!1};return this.getStoredToken().then(function(t){return function(n){return n.expires>=(new Date).getTime()&&n.hasOwnProperty("portal_id")?n.portal_id:t.refreshAuthToken(e,!0).then(t.getPortalId)}}(this),function(t){return function(n){return t.refreshAuthToken(e,!0).then(t.getPortalId)}}(this))};r.prototype.buildAuthSigning=function(e,t){null==t&&(t=!1);return t?this.refreshAuthToken(e,t):this.getStoredToken().then(function(n){return function(i){return i.expires>=(new Date).getTime()?{access_token:i.access_token}:n.refreshAuthToken(e,t)}}(this),function(n){return function(i){return n.refreshAuthToken(e,t).then(function(e){return e.expires>=(new Date).getTime()?{access_token:e.access_token}:void 0})}}(this))};r.prototype.refreshAuthToken=function(e,t){var n,r;null==e&&(e={});null==t&&(t=!1);if(t&&e.haveForced)throw new Error("Can't authorize user");n={url:new s("/signals/v1/user/access-token",{lb:"sidekick",protocol:"https"}).href,type:"GET",dataType:"json"};e.haveForced=t;r=i(o.ajax(n));return r.then(this.setStoredToken,function(e){return function(t){return e.removeStoredToken().then(function(){throw new Error("Can't authorize user")})}}(this)).then(function(t){e.haveForced=!1;return i.resolve(t)})};r.prototype.getStoredToken=function(){var e;e=i.defer();chrome.storage.sync.get("hubspotAccessToken",function(t){return chrome.runtime.lastError||!t.hubspotAccessToken?e.reject(new Error("No saved token exists")):e.resolve(t.hubspotAccessToken)});return e.promise};r.prototype.setStoredToken=function(e){var t;t=i.defer();chrome.storage.sync.set({hubspotAccessToken:{portal_id:e.portal_id,access_token:e.token,expires:e.expires_at,scopes:e.scopes}},function(n){return function(){return chrome.runtime.lastError?t.reject(new Error("Error saving token")):t.resolve({portal_id:e.portal_id,access_token:e.token,expires:e.expires_at,scopes:e.scopes})}}(this));return t.promise};r.prototype.removeStoredToken=function(){var e;e=i.defer();chrome.storage.sync.remove("hubspotAccessToken",function(){return chrome.runtime.lastError?e.reject(new Error("Error removing token")):e.resolve()});return e.promise};r.prototype.buildXhrConnectionOptions=function(e,i,o){var r,s,a;r=this.buildQueryString(o,i);if(""!==r){e=e.replace(/#.*$/,"");s=t.call(e,"?")>=0?"&":"?";e+=s+r}a=n.extend({},o,{url:e});this.useDataInQuery(o)&&delete a.data;return a};r.prototype.useDataInQuery=function(e){return"GET"===e.type&&e.processData};r.prototype.buildQueryString=function(e,t){var i,o;t&&(t=n.pick(t,"access_token"));o=n.extend({},t);this.useDataInQuery(e)&&(n.isString(e.data)?i=e.data:n.extend(o,e.data));n.extend(o,e.query);return n.compact([i,this.objToQueryString(o,!0,e.traditional)]).join("&")};r.prototype.objToQueryString=function(e,t,n){var i,r;null==t&&(t=!0);null==n&&(n=!0);for(i in e)null==e[i]&&delete e[i];r=o.param(e,n);return t?r.replace(/\+/g,"%20"):r};return r}();a.get=n.once(function(){return new a});return a})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.stringutils",[],function(){return{stripHtml:function(e){return null!=e?e.replace(/<(?:.|\n)*?>/gm,""):e}}})}).call(this);(function(){hubspot.define("sidekick.chrome.utils.timeutils",[],function(){var e,t,n,i,o,r,s;r=1e3;o=6e4;n=36e5;e=864e5;s=6048e5;t={seconds:{"short":"s","long":" sec"},minutes:{"short":"m","long":" min"},hours:{"short":"h","long":" hr"},days:{"short":"d","long":" day"}};i=function(i){var a;a=function(a){var u,c,l,d;u=Math.abs(this.diff(i()));l=null;c=null;if(r>=u){l="seconds";c=1}else if(o>u)l="seconds";else if(n>u)l="minutes";else if(e>u)l="hours";else{if("short"!==a)return this.format("MMM D");if(!(s>u))return this.format("M/D/YY");l="days"}c&&l||(c=i.duration(u)[l]());d=l=t[l][a];"long"===a&&c>1&&(d+="s");return c+d};i.fn.twitterLong=function(){return a.call(this,"long")};i.fn.twitter=i.fn.twitterShort=function(){return a.call(this,"short")};return i};return"function"==typeof define&&define.amd?define("moment-twitter",["moment"],function(e){return this.moment=i(e)}):"undefined"!=typeof module?module.exports=i(require("moment")):"undefined"!=typeof window&&window.moment?this.moment=i(this.moment):void 0})}).call(this);(function(){hubspot.require([],function(){var e,t,n,i,o,r,s;e=["http://localhost:8102","https://app.getsidekick.com","https://api.getsidekick.com","https://static.getsidekick.com","https://app.getsidekickqa.com","https://api.getsidekickqa.com","https://static.getsidekickqa.com","https://app.hubspot.com","https://app.hubspotqa.com","https://local.hubspot.com","https://local.hubspotqa.com"];n=e.concat(["https://talkgadget.google.com","http://*.talkgadget.google.com"]).join(" ");i=e.join(" ");t=/content-security-policy/i;o={urls:["https://mail.google.com/*","https://inbox.google.com/*"],types:["main_frame"]};r=["blocking","responseHeaders"];s=function(e){var o,r,s,a,u;u=e.responseHeaders;for(s=0,a=u.length;a>s;s++){r=u[s];if(t.test(r.name)){o=r.value;o=o.replace("script-src","script-src "+n);o=o.replace("style-src","style-src "+n);o=o.replace("frame-src","frame-src "+i);r.value=o}}return{responseHeaders:u}};return chrome.webRequest.onHeadersReceived.addListener(s,o,r)})}).call(this);(function(){hubspot.define("sidekick.chrome.background.notifications.doNotDisturb",["_","Q","enviro","SignalsExtension/api/DoNotDisturbApi"],function(e,t,n,i){var o,r,s,a,u,c,l,d,p,h,f,g;d=i.fetchDndStatus,h=i.saveDndStatus;o=!1;l={doNotDisturb:!1,loaded:!1,persisted:!1};s=function(e){if(!l.persisted){chrome.storage.sync.set({doNotDisturb:e});return l.persisted=!0}};u=function(){return t.Promise(function(e,t){return chrome.storage.sync.get("doNotDisturb",function(n){return null==chrome.runtime.lastError&&(null!=n?n.hasOwnProperty("doNotDisturb"):void 0)?e(n.doNotDisturb):t()})})};r=function(){return d().then(function(e){return e.get("doNotDisturb").toJS()})};c=function(e){return h(e).then(function(e){return e.toJS()})};a=e.debounce(function(e){c(e).then(function(e){var t;t=e.doNotDisturb;s(t);return l.doNotDisturb=t})["catch"](function(){s(!l.doNotDisturb);return l.doNotDisturb=!l.doNotDisturb})},1500);p=function(){return l.loaded?t(l.doNotDisturb):u()["catch"](r).then(function(e){s(e);l.doNotDisturb=e;l.loaded=!0;return e})["catch"](function(){return o})};f=function(e){l.doNotDisturb=e;l.persisted=!1;a(l.doNotDisturb);return t(l.doNotDisturb)};g=function(){return f(!l.doNotDisturb)};return{get:p,set:f,toggle:g}})}).call(this);(function(){hubspot.define("sidekick.chrome.background.notifications.parser",["_","sidekick.chrome.utils.stringutils","urlinator/Url"],function(e,t,n){var i,o,r,s,a,u,c,l,d,p,h;r={EMAIL:"EMAILOPEN",HUBSPOT:"HUBSPOT_REVISIT",HUBSPOT_COMPANYVISIT:"HUBSPOT_COMPANY_VISIT",PROSPECTS_REVISIT:"COMPANYPROSPECTS_REVISIT",PRESENTATION_REVISIT:"PRESENTATION_REVISIT",LINK:"EMAILCLICK",LIVE_CHAT_MESSAGE:"LIVE_CHAT_MESSAGE"};o={imageUrl:new n("/static/img/avatar_male_light_frame_182x182.png",{lb:"sidekickapp",protocol:"https"}).href,overlayImageUrl:chrome.extension.getURL("img/notification-overlays/overlay-none.png"),textBeforeTimestamp:"",showTimestamp:!0};s={EMAIL:"overlay-email-open.png",EMAIL_OPEN:"overlay-email-open.png",LINK:"overlay-link-click.png",EMAIL_CLICK:"overlay-link-click.png",HUBSPOT:"overlay-hubspot.png",HUBSPOT_COMPANYVISIT:"overlay-hubspot.png",HUBSPOT_COMPANY_VISIT:"overlay-hubspot.png",COMPANYPROSPECTS_REVISIT:"overlay-hubspot.png",PROSPECTS_REVISIT:"overlay-hubspot.png",PRESENTATION_REVISIT:"overlay-presentation.png"};i=e.invert(r);u={};c=function(n,i){var r,s,a;r={};r.notificationSource="PUBNUB";null!=n.avatar_url&&n.avatar_url.length>0&&(r.imageUrl=n.avatar_url);switch(n.type){case"LIVE_CHAT_MESSAGE":r.link=n.link;break;default:r.link=n.object_link}a=u[n.type];if(null==a)throw new Error("No notification handler is available for "+n.type+", did you call registerHandler?");s=a(n);e.extend(r,s);if(null==r.bigTitle||null==r.boldActionInfo)throw new Error("Notification handler for "+n.type+" failed to provide a bigTitle and a boldActionInfo.");null==r.notificationKey&&(r.notificationKey=""+e.random(1,1e5));r.overlayImageUrl&&(r.overlayImageUrl=d(r.overlayImageUrl));r.bigTitle=t.stripHtml(r.bigTitle);r.boldActionInfo=t.stripHtml(r.boldActionInfo);r.textBeforeTimestamp=t.stripHtml(r.textBeforeTimestamp);r.timestamp=Math.min(i||1/0,+new Date);return e.defaults(r,o)};l=function(i){var s,a;a={};a.suppressTracking=i.suppress_tracking||!1;a.notificationSource="CHANNEL";i.image&&i.image.length>0&&(a.imageUrl=i.image);null!=i.link&&i.link.length>0&&(a.link=i.link);null==i.object&&(i.object=i.body.replace("opened ",""));null==i.timestamp&&(i.timestamp=+new Date);null==i.tracker_key&&(i.tracker_key=i.tracker_key_name);a.timestamp=Math.min(i.timestamp,+new Date);switch(i.activity_type){case r.EMAIL:a.notificationKey=i.tracker_key;a.bigTitle=i.object;a.boldActionInfo=i.title;a.textBeforeTimestamp="opened";a.buttons=[{title:"Mute Thread",type:"PATCH",requestUrl:new n("/signals/v1/trackers/email/"+a.notificationKey+"/mute?mute=true",{lb:"sidekickapp",protocol:"https"}).href,requestPayload:JSON.stringify({activity_key:i.tracker_key}),iconUrl:"/img/notification-icons/icon-mute.png"}];break;case r.LINK:a.notificationKey=i.tracker_key;a.bigTitle=i.object;a.boldActionInfo=i.title;s=i.body.replace(i.object,"");a.textBeforeTimestamp=s.substring(0,s.length-4);break;case r.HUBSPOT:a.notificationKey=i.link;a.bigTitle=i.title;a.boldActionInfo=i.body.replace("is viewing ","");a.textBeforeTimestamp="viewed";break;case r.PROSPECTS_REVISIT:a.notificationKey=i.tracker_key;a.bigTitle=i.title;a.boldActionInfo=i.body;a.textBeforeTimestamp="";break;default:a.notificationKey=""+e.random(1,1e5);a.bigTitle=i.title;a.boldActionInfo=i.body}a.bigTitle=t.stripHtml(a.bigTitle);a.boldActionInfo=t.stripHtml(a.boldActionInfo);a.textBeforeTimestamp=t.stripHtml(a.textBeforeTimestamp);a.overlayImageUrl=p(i.activity_type);if(i.expired){a.boldActionInfo="[Upgraded HubSpot Sales trial expired]";a.link=new n("/billing",{lb:"sidekickapp",protocol:"https"}).href}return e.defaults(a,o)};d=function(e){return e?new n("/static/img/notification-overlays/"+e,{lb:"sidekickapp",protocol:"https"}).href:void 0};p=function(e){var t;t=s[i[e]];(null==t||0===t.length)&&(t=s[e]);return new n("/static/img/notification-overlays/"+t,{lb:"sidekickapp",protocol:"https"}).href};h=function(e,t){u[e]=t;return console.log("Registered notification handler for type "+e+".")};a=function(e){var t,n;t=(null!=(n=e.name)?n.length:void 0)>0?e.name:e.email;if(null!=t&&t.length>0)return t;console.log(e);throw new Error("Notification parser tried to find a name for this activity and fall back to email address, but neither were present. You probably can't use getSuggestedNameFromSource for your notification type.")};return{getSuggestedNameFromSource:a,notificationFromJson:l,notificationFromActivity:c,registerHandler:h}})}).call(this);(function(){hubspot.define("sidekick.chrome.background.notifications.pubnub",["PUBNUB","sidekick.chrome.utils.sidekickApi","SignalsExtension/constants/Pubnub","_"],function(e,t,n,i){var o,r,s,a,u,c,l,d,p,h,f,g,m,b;s=n.UUID_STORAGE_KEY,o=n.CONFIG_ENDPOINT,r=n.ERROR_RETRY_RATE;h=null;b=null;a=null;d=function(n){return p()?void 0:chrome.storage.local.get(s,function(i){var r;if(null!=i&&null!=i[s]){b=i[s];console.log("Using saved UUID for pubnub: "+b)}else{b=e.uuid();r={};r[s]=b;chrome.storage.local.set(r,function(){return console.log("Set saved UUID for pubnub: "+b)})}return t.apiRequest(o,{data:{uuid:b}}).then(function(t){var i,o,r,s,a,u;o=t.channel,i=t.broadcast_channel,u=t.token,s=t.subscribe_key,r=t.expires_at,a=t.timeout_seconds;console.log("First-time init of pubnub with "+u);h=e.init({subscribe_key:s,uuid:b,auth_key:u,heartbeat:a,ssl:!0,instance_id:!0});return g([o,i],n)}).done()})};g=function(e){return function(e,t){console.log("Subscribing to pubnub channels "+e);a=e;return h.subscribe({channel:e,message:t,connect:c,error:l})}}(this);c=function(e){return console.log("Connected to PubNub channel "+e)};l=function(e){return function(e){var t;t=(null!=e?e:{}).message;return"Forbidden"===t?m().then(function(){console.log("retrying after unsub");u();return f()}):void 0}}(this);f=i.throttle(function(){return t.apiRequest(o,{data:{uuid:b}}).then(function(t){var n,i,o,r,s;s=t.token,i=t.channel,n=t.broadcast_channel,r=t.timeout_seconds,o=t.subscribe_key;console.log("Retrying with token "+s+" and UUID "+b);h=e.init({subscribe_key:o,uuid:b,auth_key:s,heartbeat:r,ssl:!0,instance_id:!0});return g([i,n])}).done()},r);m=function(){return Q.Promise(function(e){console.log("Unsubscribing from "+a);return h.unsubscribe({channel:a,callback:function(){return e()}})})};u=function(){return h.auth("")};p=function(){return(null!=h?h.get_subscibed_channels().length:void 0)>0};return{init:d,unsubscribeFromChannels:m,clearAuth:u}})}).call(this);(function(){hubspot.define("sidekick.chrome.background.notifications.samples",["_","urlinator/Url"],function(e,t){var n,i,o,r,s,a,u;n=new t({lb:"sidekickapp",protocol:"https"}).href;o=[{activity_key:"3dfba5e4-ce88-4f49-8d86-19d7a68522ae",activity_type:"EMAILOPEN",body:"opened test",buttons:[],expired:!1,html:null,id:"3dfba5e4-ce88-4f49-8d86-19d7a68522ae",image:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",link:null,object:"test",sticky:!1,timestamp:1427823308658,title:"Joshua Tsuji",tracker_key:"47995535-ea0c-4baa-a35a-c6e94b25d7a9",tracker_key_name:"47995535-ea0c-4baa-a35a-c6e94b25d7a9"},{activity_key:"352f562e-d846-4a5b-aecc-e6495ffd5d96",activity_type:"EMAILCLICK",body:"clicked Links! in Test Email",buttons:[],expired:!1,html:null,id:"352f562e-d846-4a5b-aecc-e6495ffd5d96",image:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",link:null,object:"Test Email",sticky:!1,timestamp:1427824245532,title:"Joshua Tsuji",tracker_key:"1bcc3a79-4f27-4b26-9853-838f16038bc0-17841"},{activity_key:"agxzfnNpZ25hbHNjcnhyUAsSC1VzZXJQcm9maWxlGICAgLveupwIDAsSCEFjdGl2aXR5Iipoc3JldmlzaXR8Zjc4N2ZhNDJkN2NlMTFlNDhkMzFhYmNkOGVhN2IwZDcM",activity_type:"HUBSPOT_REVISIT",body:'is viewing <a class="activity-link" href="http://hubspot.com/pricing" target="_blank">Enterprise Pricing</a>',buttons:[],expired:!1,html:"",id:"None",image:"https://api.hubapi.com/socialintel/v1/avatars?email=dshah%40hubspot.com",link:"http://app.hubspot.com/contacts/53/lists/contact/400379/",sticky:!1,title:"Dharmesh Shah",timestamp:1427824245532,tracker_key_name:null},{activity_key:"f8412886-4ffc-42ae-b491-b7d828986ada",activity_type:"COMPANYPROSPECTS_REVISIT",body:"clicked Some Link in Automation Workflows | HubSpot",buttons:[],expired:!1,html:null,id:"f8412886-4ffc-42ae-b491-b7d828986ada",image:"https://api.hubapiqa.com/biden/v1/images/hubspot.com/54011613743043",link:null,object:"Automation Workflows | HubSpot",sticky:!1,timestamp:1433791508e3,title:"hubspot",tracker_key:"companyprospects.hubspot.com.1433870923009"}];i={EMAIL_OPEN:{messageType:"ACTIVITY",data:{object_link:"https://mail.google.com/mail/u/?authuser=jtsuji@hubspot.com#all/14ff66235bf0fa49",owner_id:4628763151171584,tracker_key:"b36fa6fc-4894-4358-82c0-3d3bcbbefea9",secondary_key:"joshuatsuji@gmail.com",logged_to_crm:!1,source:{is_exact:!0,is_mobile:!1,ip:"66.249.83.240",domain:"gmail.com",name:"Joshua Tsuji",location:"",email:"joshuatsuji@gmail.com"},type:"EMAIL_OPEN",client_id:1,tracker_created:1442947675740,avatar_url:"https://api.hubapi.com/socialintel/v1/avatars?email=jtsuji@hubspot.com",thread_info:{depth:0,id:"b36fa6fc-4894-4358-82c0-3d3bcbbefea9"},guid:"2c81f670",template_id:"",portal_id:468087,object:"aaaa",timestamp:1442947712602},recipients:[],userId:4628763151171584,timestamp:1444831784880},EMAIL_CLICK:{messageType:"ACTIVITY",data:{source:{guid:"7ddbf9d8",name:"Joshua Tsuji",email:"jtsuji@hubspot.com",location:"Cambridge, Massachusetts",user_agent:"",ip:"",link:"",domain:"hubspot.com",is_exact:!0,is_mobile:!1,timestamp:1433430557237},type:"EMAIL_CLICK",object:"Test Email",object_link:"https://mail.google.com/mail/u/?authuser=",link:"http://www.apple.com",avatar_url:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",tracker_key:"60ec61a0-ac5a-4582-b677-b373e74ee165-16954",secondary_key:"ablyakher@hubspot.com",owner_id:5706718366400512,guid:"7ddbf9d8",timestamp:1433430557237,link_title:"Links!",muted:!1,portal_id:null,thread_info:null},recipients:[],userId:4628763151171584,timestamp:1427824245532},HUBSPOT_COMPANY_VISIT:{messageType:"ACTIVITY",recipients:[],userId:4628763151171584,timestamp:1427824245532,data:{type:"HUBSPOT_COMPANY_VISIT",source:{name:"HubSpot",email:"",location:"",user_agent:"",ip:"1.1.1.1",link:"",domain:"hubspot.com",is_exact:!1,is_mobile:!1,timestamp:0},object_link:"http://www.hubspot.com",link:"",avatar_url:"",tracker_key:"hubspot.com",secondary_key:"",owner_id:5003267851419648,guid:"a",timestamp:1393879369e3,link_title:"",deleted:!1,updated_at:0,dual_write:!1,team_id:0,muted:!1,object:"Some Page"}},COMPANYPROSPECTS_REVISIT:{messageType:"ACTIVITY",recipients:[],userId:4628763151171584,timestamp:1427824245532,data:{type:"COMPANYPROSPECTS_REVISIT",source:{name:"Joshua Tsuji",email:"jtsuji@hubspot.com",location:"",user_agent:"",ip:"",link:"",domain:"",is_exact:!1,is_mobile:!1,timestamp:0},object_link:"https://ej4.com/",link:"https://app.hubspot.com/sales/53/visits/list/view/69133",avatar_url:"http://m.c.lnkd.licdn.com/media/p/1/000/271/38f/391301b.png",tracker_key:"24r4444",secondary_key:"",owner_id:3,guid:"efe",timestamp:1443676697995,link_title:"",deleted:!1,updated_at:0,dual_write:!0,team_id:0,muted:!1,object:"Some Page"}},PRESENTATION_REVISIT:{messageType:"ACTIVITY",recipients:[],userId:4628763151171584,timestamp:1427824245532,data:{type:"PRESENTATION_REVISIT",source:{name:"Joshua Tsuji",email:"jtsuji@hubspot.com",location:"",user_agent:"",ip:"",link:"",domain:"",is_exact:!1,is_mobile:!1,timestamp:0},object_link:"https://app.hubspot.com/presentations/53/present/19192",link:"",avatar_url:"",tracker_key:"19192",secondary_key:"",owner_id:6635603960004608,guid:"25d9badf-4278-4495-b59a-6eddb22b73cc",timestamp:1432245434287,link_title:"",deleted:!1,updated_at:0,dual_write:!0,team_id:0,muted:!1,object:"About HubSpot (PDF)"}}};s=[{suppressTracking:!1,imageUrl:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",timestamp:1427823308658,notificationKey:"47995535-ea0c-4baa-a35a-c6e94b25d7a9",bigTitle:"test",boldActionInfo:"Joshua Tsuji",textBeforeTimestamp:"opened",buttons:[{title:"Mute Thread",type:"PATCH",requestUrl:"signals/v1/trackers/email/47995535-ea0c-4baa-a35a-c6e94b25d7a9/mute?mute=true",requestPayload:'{"activity_key":"47995535-ea0c-4baa-a35a-c6e94b25d7a9"}',iconUrl:"/img/notification-icons/icon-mute.png"}],overlayImageUrl:n+"/static/img/notification-overlays/overlay-email-open.png",link:n+"/stream",notificationSource:"CHANNEL"},{bigTitle:"Test Email",boldActionInfo:"Joshua Tsuji",imageUrl:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",link:n+"/stream",notificationKey:"1bcc3a79-4f27-4b26-9853-838f16038bc0-17841",overlayImageUrl:n+"/static/img/notification-overlays/overlay-link-click.png",suppressTracking:!1,textBeforeTimestamp:"clicked Links!",timestamp:1427824245532,notificationSource:"CHANNEL"},{bigTitle:"Dharmesh Shah",boldActionInfo:"Enterprise Pricing",imageUrl:"https://api.hubapi.com/socialintel/v1/avatars?email=dshah%40hubspot.com",link:"http://app.hubspot.com/contacts/53/lists/contact/400379/",notificationKey:"http://app.hubspot.com/contacts/53/lists/contact/400379/",overlayImageUrl:n+"/static/img/notification-overlays/overlay-hubspot.png",suppressTracking:!1,textBeforeTimestamp:"viewed",timestamp:1427824245532,notificationSource:"CHANNEL"}];r={EMAIL_OPEN:{notificationSource:"PUBNUB",imageUrl:"https://api.hubapi.com/socialintel/v1/avatars?email=jtsuji@hubspot.com",link:"https://mail.google.com/mail/u/?authuser=jtsuji@hubspot.com#all/14ff66235bf0fa49",notificationKey:"b36fa6fc-4894-4358-82c0-3d3bcbbefea9",bigTitle:"aaaa",boldActionInfo:"Joshua Tsuji",textBeforeTimestamp:"opened",buttons:[{title:"Mute Thread",type:"PATCH",requestUrl:"signals/v1/trackers/email/b36fa6fc-4894-4358-82c0-3d3bcbbefea9/mute?mute=true",requestPayload:'{"activity_key":"b36fa6fc-4894-4358-82c0-3d3bcbbefea9"}',iconUrl:"/img/notification-icons/icon-mute.png"}],overlayImageUrl:n+"/static/img/notification-overlays/overlay-email-open.png",timestamp:1445034637372},EMAIL_CLICK:{notificationSource:"PUBNUB",imageUrl:"https://api.hubapi.com/socialintel/v1/avatars?email=ablyakher@hubspot.com",link:"https://mail.google.com/mail/u/?authuser=",notificationKey:"60ec61a0-ac5a-4582-b677-b373e74ee165-16954",bigTitle:"Test Email",boldActionInfo:"Joshua Tsuji",overlayImageUrl:n+"/static/img/notification-overlays/overlay-link-click.png",textBeforeTimestamp:"clicked Links!",timestamp:1451940278510},HUBSPOT_COMPANY_VISIT:{notificationSource:"PUBNUB",link:"http://www.hubspot.com",notificationKey:"http://www.hubspot.com",bigTitle:"HubSpot",boldActionInfo:"Some Page",overlayImageUrl:n+"/static/img/notification-overlays/overlay-hubspot.png",textBeforeTimestamp:"viewed",timestamp:1451940487600,imageUrl:n+"/static/img/avatar_male_light_frame_182x182.png"},COMPANYPROSPECTS_REVISIT:{notificationSource:"PUBNUB",imageUrl:"http://m.c.lnkd.licdn.com/media/p/1/000/271/38f/391301b.png",link:"https://ej4.com/",notificationKey:"https://app.hubspot.com/sales/53/visits/list/view/69133",bigTitle:"Joshua Tsuji",boldActionInfo:"Some Page",overlayImageUrl:n+"/static/img/notification-overlays/overlay-hubspot.png",textBeforeTimestamp:"viewed",timestamp:1451940603477},PRESENTATION_REVISIT:{notificationSource:"PUBNUB",link:"https://app.hubspot.com/presentations/53/present/19192",notificationKey:"https://app.hubspot.com/presentations/53/present/19192",bigTitle:"Joshua Tsuji",boldActionInfo:"About HubSpot (PDF)",overlayImageUrl:n+"/static/img/notification-overlays/overlay-hubspot.png",textBeforeTimestamp:"viewed",timestamp:1451940635742,imageUrl:n+"/static/img/avatar_male_light_frame_182x182.png"}};a=function(t,n){null==t&&(t={});null==n&&(n=0);return e.defaults(t,o[n])};u=function(t,n){null==t&&(t={});null==n&&(n="EMAIL_OPEN");return e.defaults(t,i[n])};return{validNotificationWithProperties:a,validPubnubNotificationWithProperties:u,DEMO_NOTIFS:o,DEMO_ACTIVITY_NOTIFS:i,EXPECTED_PARSINGS:s,EXPECTED_ACTIVITY_PARSINGS:r}})}).call(this);(function(){hubspot.define("sidekick.chrome.background.requestBlocker",["_","moment","sidekick.chrome.constants.matchers","sidekick.chrome.backbone.models.user","sidekick.chrome.backbone.models.options","SignalsExtension/background/backgroundMessaging","SignalsExtension/background/notifications/manager","SignalsExtension/background/trackJsonAction","urlinator/Url"],function(e,t,n,i,o,r,s,a,u){var c,l,d,p,h,f,g,m,b,k,v,_,y,S,E,T,I;_=r.listenToContentScripts,E=r.routerEventingShim;y=s.postNotification;d=n.EVENT_TRACKER_SECONDARY_ID,l=n.EVENT_TRACKER_PRIMARY_ID,p=n.EVENT_TRACKER_TARGET,h=n.GOOGLE_CONTENT_PROXY;c={allow:{cancel:!1},block:{cancel:!0}};S=[];v=function(){E.on("startup",I);_("saveTracker",f,null);return null!=localStorage.muteCount?localStorage.muteCount:localStorage.muteCount=0};f=function(e){return S.push({key:e.key,time:new Date})};I=function(){var e,t,n,o;e=new u({lb:"sidekickapp",protocol:"https"}).href;n=i.getKey();t=i.getId();o=["*://*.googleusercontent.com/proxy/*",e+"/img.gif?ukey="+n+"*","*://*/e1t/o/*","*://*/e1t/c/*"];chrome.webRequest.onBeforeRequest.hasListener(g)&&chrome.webRequest.onBeforeRequest.removeListener(g);return chrome.webRequest.onBeforeRequest.addListener(g,{urls:o},["blocking"])};T=function(n){return function(n,r,s){var c,d,p,h,f,g,m;if(o.hasSelfOpens()){h=localStorage.muteMyself;if(null==h||"true"!==h){c=parseInt(localStorage.muteCount||"0");if(!(c>5)){localStorage.muteCount=c+1;if(s){m=null!=(g=n.match(l))?g[1]:void 0;if(null==m)return;d=t().subtract("seconds",15)._d;p=e.find(S,function(e){return e.key===m});if(null!=p&&null!=p.time&&d<p.time)return}a("Notifications - Myself Notif");f={timestamp:+new Date,notificationKey:"blockednotif"+Math.random(),bigTitle:"You opened your own email",boldActionInfo:"This activity won't show up in your stream. Opened",imageUrl:new u("/avatar/image/?emails="+i.getVerifiedEmail(),{lb:"sidekickapp",protocol:"https"}).href,overlayImageUrl:"https://app.getsidekick.com/static/img/notification-overlays/overlay-email-open.png",textBeforeTimestamp:"",suppressTracking:!0,buttons:[{title:"Mute Myself",iconUrl:"",clickAction:function(){return localStorage.muteMyself=!0}},{title:"Learn More",iconUrl:"",clickAction:function(){return window.open("http://sales.hubspot.com/knowledge/receiving-notifications/article/opened-your-own-email","_blank")}}]};return y(f)}}}}}(this);g=function(e){var t,n,o,r,s,a,u,l,h;l=e.url;u=i.getKey();h=i.getId();t=l.match(d);o=l.match(p);n=-1!==l.indexOf(u);if(t&&!o){r=t[0],s=t[1];return k("open",l,h,s)}if(t&&o){r=t[0],
s=t[1];r=o[0],a=o[1];return k("click",l,h,s,a)}return n?m(l,h):c.allow};k=function(e,t,n,i,o){var r,s;s=t.match(h);r=parseInt(i)===n;return r?b(e,t,n,o):s?{redirectUrl:decodeURIComponent(t.split("#")[1])}:c.allow};b=function(t,n,i,o){switch(t){case"open":e.delay(T,2500,n,i,!0);return c.block;case"click":return{redirectUrl:decodeURIComponent(o)}}};m=function(t,n){e.delay(T,2500,t,n,!1);return c.block};return{init:v}})}).call(this);(function(){hubspot.define("sidekick.chrome.trackerSaver",["sidekick.chrome.utils.console","sidekick.chrome.utils.sidekickApi","SignalsExtension/background/backgroundMessaging","sidekick.chrome.utils.Track","SignalsExtension/utils/getChromeVersion"],function(e,t,n,i,o){var r,s,a,u,c,l,d,p;d=n.listenToContentScripts;r="signals/v1/trackers/email";a=5;s=1e4;u="Failed tracker creation after "+a+" retries";l=function(){return d("saveTracker",p,this)};p=function(n){var i,u,l;e.debug("Saving Tracker: ",JSON.stringify(n));u=n.key,i=n.content;i.email.chrome_config={sidekick_version:chrome.runtime.getManifest().version,platform_version:o()};l={type:"POST",data:i,retryType:"linear",retries:a,retryBackoff:s};return t.apiRequest(r+"/"+u,l)["catch"](c).done()};c=function(){i.error({message:u})};return{init:l,save:p}})}).call(this);(function(){hubspot.define("sidekick.chrome.background.updateManager",["_","sidekick.chrome.utils.console","SignalsExtension/data/salesGates","SignalsExtension/background/trackJsonAction","urlinator/Url"],function(e,t,n,i,o){var r,s,a,u,c,l,d,p,h,f;u=1e4;a=6e4;s=240*a;r=chrome.runtime.getManifest().version;c=new o("/uninstall",{lb:"sidekickapp",protocol:"https"}).href;l="update_available";p=function(){chrome.runtime.onInstalled.addListener(function(n){var o;o=(null!=n?n:{}).reason;if("update"===o){t.log("Updated to "+r);return e.delay(function(){return i("chrome-extension-updated",{version:r})},u)}});return chrome.runtime.onUpdateAvailable.addListener(function(){return chrome.runtime.reload()})};h=function(){return e.isFunction(chrome.runtime.setUninstallURL)?chrome.runtime.setUninstallURL(c):void 0};d=e.throttle(function(){return n.get().then(function(){if(!n.userUngatedFor("disable_chrome_update_checker")){t.log("Requesting update check");return chrome.runtime.requestUpdateCheck(function(e,n){var o;o=(null!=n?n:{}).version;t.log("Update check result: "+e+" "+o);return e===l?i("chrome-update-available",{version:r}):void 0})}}).done()},s);f=e.once(function(){p();h();return e.delay(function(){d();return setInterval(d,s)},a)});return{start:f}})}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};hubspot.define("sidekick.chrome.userData",["jQuery","Q","sidekick.chrome.utils.http","sidekick.chrome.backbone.models.user","SignalsExtension/utils/getChromeVersion"],function(t,n,i,o,r){var s;s=function(){function s(){this._parseGmailData=e(this._parseGmailData,this);this._getGmailData=e(this._getGmailData,this);this.update=e(this.update,this)}s.prototype.update=function(){return this._getGmailData().then(function(e){var t;t={extension_version:chrome.runtime.getManifest().version,chrome_version:r(),user_agent:window.navigator.userAgent};if(null!=e){t.gmail_email=e.email;t.scraped_name=e.name}o.set(t);o.save()})};s.prototype._getGmailData=function(){return n.Promise(function(e){return function(t){var n,o;o="https://www.google.com/settings/general-light";n={type:"GET",dataType:"text"};return i.makeRequest(o,n).then(e._parseGmailData).then(t)["catch"](function(){return t(null)})}}(this))};s.prototype._parseGmailData=function(e){var n,i,o,r;i=e.replace(/img[ ]src=["][\/][\/]/,'img src="http://');n=t(t.parseHTML(i));r=n.find(".gXAT7 > td").text();o=n.find(".lS2qGd").text();return null!=r&&""!==r&&null!=o&&""!==o?{name:r,email:o}:null};return s}();return new s})}).call(this);hubspot.define("SignalsExtension/api/DoNotDisturbApi",["SignalsExtension/api/SidekickAppHttpClient"],function(e){"use strict";var t={},n=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(e),o=function(){return i.get("subscribe/desktop/global")};t.fetchDndStatus=o;var r=function(e){return i.post("subscribe/desktop/global",{data:{doNotDisturb:e}})};t.saveDndStatus=r;return t});hubspot.define("SignalsExtension/api/FireAlarmApi",["SignalsExtension/api/SidekickHttpClient"],function(e){"use strict";var t={},n=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(e),o=function(){return i.get("alarm/v1/messages/signals:client:chrome").then(function(e){return e.get("message")})};t.fetchAlarmStatus=o;return t});hubspot.define("SignalsExtension/api/SidekickAppHttpClient",["hub-http","hub-http/adapters/promiseClient","hub-http/middlewares/core","hub-http/middlewares/debug","hub-http-contrib/middlewares/sidekickDefaults","hub-http-contrib/middlewares/immutable"],function(e,t,n,i,o,r){"use strict";var s={},a=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(s,"__esModule",{value:!0});var u=a(t),c=a(o);s=u(e.createStack(n.services,c,n.jsonBody,n.httpsOnly,n.environmentUrl(n.standardApi("app","getsidekick")),n.withQuery,i.rewriteUrl,n.validateStatus,r.immutableResponse));return s});hubspot.define("SignalsExtension/api/SidekickHttpClient",["hub-http","hub-http/adapters/promiseClient","hub-http/middlewares/core","hub-http/middlewares/debug","hub-http-contrib/middlewares/sidekickDefaults","hub-http-contrib/middlewares/immutable"],function(e,t,n,i,o,r){"use strict";var s={},a=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(s,"__esModule",{value:!0});var u=a(t),c=a(o);s=u(e.createStack(n.services,c,n.jsonBody,n.httpsOnly,n.environmentUrl(n.standardApi("api","getsidekick")),n.withQuery,i.rewriteUrl,n.validateStatus,r.immutableResponse));return s});hubspot.define("SignalsExtension/background/accountManager",["_","enviro","urlinator/Url","sidekick.chrome.constants.cookieDescriptors","SignalsExtension/background/browserAction","SignalsExtension/utils/tabs","sidekick.chrome.utils.console","SignalsExtension/background/backgroundMessaging","sidekick.chrome.backbone.models.user","hubspot.HublyticsTrackerJS.SidekickTracker","sidekick.chrome.background.notifications.pubnub","sidekick.chrome.userData","SignalsExtension/background/trackJsonAction","SignalsExtension/background/notifications/pubnubHandler","SignalsExtension/globals/chrome","SignalsExtension/globals/Raven","SignalsExtension/utils/onSidekickCookieChanged","SignalsExtension/data/firstRunTracker","SignalsExtension/data/openSignup"],function(e,t,n,i,o,r,s,a,u,c,l,d,p,h,f,g,m,b,k){"use strict";var v={},_=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(v,"__esModule",{value:!0});var y=_(e),S=_(t),E=_(n),T=_(s),I=_(u),w=_(c),x=_(l),A=_(d),C=_(p),O=_(h),N=_(f),P=_(g),M=_(m),R=_(k),D=6e5,U=!1,L=!1,j=function(){a.listenToContentScripts("fetchUserModel",function(){return I.fetch()});o.updateIcon(!1);B(function(){T.debug("Connected to Server");try{var e={};I.loggedIn()&&(e.email=I.getVerifiedEmail());w.init("sidekick",e);w.trackScreen("chrome")}catch(t){}H()});M(i.SIDEKICK_COOKIE_NAME,function(e){U||(e.removed?K(z):z())})},B=function(e){function t(t){return e.apply(this,arguments)}t.toString=function(){return e.toString()};return t}(function(e){z({success:function(t){t?e():K(function(t){if(t)return z({success:function(t){t||V();o.updateIcon(t);return e()},error:function(){return e()}});V();return e()});return y.delay(z,36e5)},error:function(){T.debug("Retrying login");y.delay(B,5e3,e)}})}),H=function(){return N.runtime.onConnect.addListener(function(e){T.debug("Got connection");e.postMessage({method:"userModel",user_profile:I.toJSON()})})},V=function(){N.cookies.get({url:"http://getsignals.com",name:i.SIDEKICK_COOKIE_NAME},function(e){if(null!=e){y.defer(function(){return C("Extension - Found getsignals cookie")});r.openNewTab(new E("/login",{lb:"sidekickapp",protocol:"https"}).href)}else b.isFirstRun()&&R()})},K=function(e){if(L)Z();else{U=!0;N.storage.sync.get("signalsCookie",function(t){var n=t.signalsCookie;if(null!=n){var o={url:i.SIDEKICK_COOKIE[S.getShort("api")].url,name:i.SIDEKICK_COOKIE_NAME,value:n.value,domain:n.domain,path:n.path,expirationDate:n.expirationDate};return N.cookies.set(o,function(){C("Cookie Restored - Extension");e&&e(!0);U=!1;L=!0;return X()})}e&&e(!1);U=!1;L=!0;return X()})}},q=function(){L=!1},F=function(){C("Cookie Restore Failed - Extension")},G=function(){N.cookies.get({name:i.SIDEKICK_COOKIE_NAME,url:i.SIDEKICK_COOKIE[S.getShort("api")].url},function(e){null!=e&&N.storage.sync.set({signalsCookie:e})})},J=function(){return x.unsubscribeFromChannels()["finally"](function(){x.clearAuth();b.setNotFirstRun().then(N.runtime.reload);r.reloadGmailTabs();o.updateIcon(!1)}).done()},Y=function(){T.debug("Logged In");G();x.init(O);A.update();r.reloadGmailTabs();P.setUser({email:I.getVerifiedEmail(),id:I.getKey()});try{w.hasEmail()||w.init("sidekick",{email:I.getVerifiedEmail()})}catch(e){}a.routerEventingShim.trigger("startup");o.updateIcon()},Q=function(e){I.loggedIn()&&null!=e&&e(!0);z({success:function(t){null!=e&&e(t)},error:function(){null!=e&&e(!1)}})},z=function(e){var t=I.loggedIn();return I.fetch({success:function(){var n=I.loggedIn();T.debug("Validated Session "+n+" "+t);var i=function(){null!=(null!=e?e.success:void 0)&&e.success(n);t===!1&&n===!0&&W();t===!0&&n===!1&&J();return a.sendToContentScripts("updateInjectedUserData")};if(n){T.debug("Logged in ok, persisting session details");N.storage.sync.set({signalsSession:I.toJSON()});i()}else{T.debug("Not logged in, checking existing session");N.storage.sync.get("signalsSession",function(e){if(null!=e.signalsSession){I.set(e.signalsSession);var t=I.getTrackingProperties();if(!I.loggedIn()){I.clear();return}C("Logged Out - Extension (Cookie Dropped)",t);N.storage.sync.remove("signalsSession")}});i()}},error:function(t){null!=(null!=e?e.error:void 0)&&e.error(t)}})},W=y.debounce(Y,1e3),X=y.debounce(q,D),Z=y.debounce(F,D);v={init:j,checkLoggedIn:Q,logout:J,validateSession:z};return v});hubspot.define("SignalsExtension/background/backgroundMessaging",["_","Backbone","sidekick.chrome.utils.console","SignalsExtension/globals/chrome","SignalsExtension/utils/tabs"],function(e,t,n,i,o){"use strict";var r={},s=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(r,"__esModule",{value:!0});var a=s(t),u=s(n),c=s(i),l=function(e,t){o.forAllTabs(null,function(n){c.tabs.sendMessage(n.id,{method:e,data:t})})};r.sendToContentScripts=l;var d=function(e,t,n){var i=function(i){if(i.method===e)try{t.apply(n,[i.data])}catch(o){u.error(o);u.info(e);u.debug(i.data);u.debug(n)}};c.runtime.onMessage.addListener(i)};r.listenToContentScripts=d;var p=e.extend({},a.Events);r.routerEventingShim=p;return r});hubspot.define("SignalsExtension/background/browserAction",["SignalsExtension/api/FireAlarmApi","sidekick.chrome.utils.console","sidekick.chrome.backbone.models.options","sidekick.chrome.background.notifications.doNotDisturb","SignalsExtension/globals/chrome","SignalsExtension/utils/tabs","SignalsExtension/background/backgroundMessaging"],function(e,t,n,i,o,r,s){"use strict";var a={},u=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(a,"__esModule",{value:!0});var c=u(t),l=u(n),d=u(i),p=u(o),h=function(e){var t=e&&!l.hasAlarm()?"":"!",n=l.getNotifications();!t&&n>0&&(t=n.toString());p.browserAction.setBadgeText({text:t})},f=function(){l.setNotifications(0);h(!0)},g=function(e){c.debug("Updating Browser Action Icon, loggedIn: "+e);d.get().then(function(t){var n={};e===!1||t?n.path={19:"../img/hubspot-logo-bg-19-grey.png",38:"../img/hubspot-logo-bg-48-grey.png"}:n.path={19:"../img/hubspot-logo-bg-19.png",38:"../img/hubspot-logo-bg-48.png"};p.browserAction.setIcon(n);h(e)})},m=function(){var e=l.getNotifications();l.setNotifications(e+1);h(!0)},b=function(){return e.fetchAlarmStatus().then(function(e){return l.setAlarmStatus(e)})["catch"](function(e){if(401!==e.status)throw e})},k=function(){b().done(function(){return h(!1)});s.listenToContentScripts("route:restart",r.restartExtension)};a={updateBadge:h,clearBadge:f,updateIcon:g,incrementBadge:m,checkAlarm:b,init:k};return a});hubspot.define("SignalsExtension/background/extensionActions",["enviro","sidekick.chrome.common.utils.hubSpotApi","sidekick.chrome.userData","SignalsExtension/globals/chrome","SignalsExtension/background/accountManager","SignalsExtension/utils/onSidekickCookieChanged","sidekick.chrome.constants.cookieDescriptors"],function(e,t,n,i,o,r,s){"use strict";var a={},u=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(a,"__esModule",{value:!0});var c=u(e),l=u(t),d=u(n),p=u(i),h=u(r),f="extension_action",g=function(){o.validateSession({success:function(e){if(e){l.get().refreshAuthToken();d.update()}}})},m=function(e){switch(e){case"settings":g();break;case"logout":p.storage.sync.clear();o.logout()}},b=function(){h(f,function(e){var t=e.cookie,n=e.removed;if(!n){m(t.value);p.cookies.remove({url:s.SIDEKICK_COOKIE[c.getShort("api")].url,name:f})}})};a={init:b};return a});hubspot.define("SignalsExtension/background/notifications/activityHandlerRegistration",["sidekick.chrome.background.notifications.parser","SignalsExtension/globals/chrome","SignalsExtension/globals/open"],function(e,t,n){"use strict";var i={},o=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(i,"__esModule",{value:!0});var r=o(e),s=o(t),a=o(n);i=function(){r.registerHandler("EMAIL_CLICK",function(e){var t=e.tracker_key,n=e.object,i=e.source,o=e.link_title;return{notificationKey:t,bigTitle:n,boldActionInfo:r.getSuggestedNameFromSource(i),overlayImageUrl:"overlay-link-click.png",textBeforeTimestamp:"clicked "+o}});r.registerHandler("HUBSPOT_COMPANY_VISIT",function(e){var t=e.object,n=e.object_link,i=e.source;return{notificationKey:n,bigTitle:r.getSuggestedNameFromSource(i),boldActionInfo:t,overlayImageUrl:"overlay-hubspot.png",textBeforeTimestamp:"viewed"}});r.registerHandler("HUBSPOT_REVISIT",function(e){var t=e.object,n=e.object_link,i=e.source;return{notificationKey:n,bigTitle:r.getSuggestedNameFromSource(i),boldActionInfo:t,overlayImageUrl:"overlay-hubspot.png",textBeforeTimestamp:"viewed"}});r.registerHandler("COMPANYPROSPECTS_REVISIT",function(e){var t=e.object,n=e.source,i=e.link;return{notificationKey:i,bigTitle:r.getSuggestedNameFromSource(n),boldActionInfo:t,overlayImageUrl:"overlay-hubspot.png",textBeforeTimestamp:"viewed"}});r.registerHandler("PRESENTATION_REVISIT",function(e){var t=e.object,n=e.object_link,i=e.source;return{notificationKey:n,bigTitle:r.getSuggestedNameFromSource(i),boldActionInfo:t,overlayImageUrl:"overlay-hubspot.png",textBeforeTimestamp:"viewed"}});r.registerHandler("EMAIL_OPEN",function(e){var t=e.tracker_key,n=e.object,i=e.source;return{notificationKey:t,bigTitle:n,boldActionInfo:r.getSuggestedNameFromSource(i),overlayImageUrl:"overlay-email-open.png",textBeforeTimestamp:"opened",buttons:[{title:"Mute Thread",type:"PATCH",requestUrl:"signals/v1/trackers/email/"+t+"/mute?mute=true",requestPayload:JSON.stringify({activity_key:t}),iconUrl:"/img/notification-icons/icon-mute.png"}]}});r.registerHandler("LIVE_CHAT_MESSAGE",function(e){var t=e.link,n=e.object,i=e.object_link;return{link:t,bigTitle:"New chat on "+i,boldActionInfo:'"'+n+'"',imageUrl:s.extension.getURL("img/notification-icons/icon-chat-open.svg"),showTimestamp:!1,buttons:[{title:"Click to Respond",clickAction:function(){return a(t)}}]}})};return i});hubspot.define("SignalsExtension/background/notifications/manager",["sidekick.chrome.background.notifications.parser","sidekick.chrome.background.notifications.samples","SignalsExtension/background/browserAction","sidekick.chrome.constants.notifications.manager","sidekick.chrome.background.notifications.doNotDisturb","sidekick.chrome.utils.console","sidekick.chrome.blackBox","sidekick.chrome.utils.sidekickApi","Q","_","SignalsExtension/background/trackJsonAction","urlinator/Url","SignalsExtension/globals/chrome","SignalsExtension/globals/document","SignalsExtension/globals/window","moment","Humanize","SignalsExtension/globals/open"],function(e,t,n,i,o,r,s,a,u,c,l,d,p,h,f,g,m,b){"use strict";var k={},v=function(e){return e&&e.__esModule?e["default"]:e},_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};Object.defineProperty(k,"__esModule",{value:!0});var y=v(e),S=v(t),E=v(o),T=v(r),I=v(s),w=v(a),x=v(u),A=v(c),C=v(l),O=v(d),N=v(p),P=v(h),M=v(g),R=v(m),D=v(b),U=[],L=function(){N.notifications.onClicked.addListener(Y);N.notifications.onButtonClicked.addListener(Q)};k.init=L;var j=function(e){return H(e.timestamp).then(function(t){t&&V(y.notificationFromJson(e))})};k.postNotificationFromChannelJson=j;var B=function(e,t){return H(t).then(function(n){n&&V(y.notificationFromActivity(e,t))})};k.postNotificationFromActivity=B;var H=function(e){return x.promise(function(t){var n=new Date;if(null!=e&&e<n-i.MIN_AGE_OFFSET){C("Notification Suppressed - Extension",{notificationAgeMinutes:Math.floor((n-e)/1e3/60)});t(!1)}else t(!0)})},V=function(e){return E.get().then(function(t){if(!t){var n=new Date;U.push(e);var o=A.filter(U,function(t){return t.notificationKey===e.notificationKey&&t.timestamp>n-i.MIN_AGE_OFFSET});A.sortBy(o,"timestamp");F(e,o).then(function(t){return G(e,o,t)})}})};k.postNotification=V;var K=function(){var e=void 0===arguments[0]?{}:arguments[0],t=void 0===arguments[1]?0:arguments[1],n=S.validNotificationWithProperties(e,t);n.timestamp=new Date;j(n)};k.postSampleNotification=K;var q=function(e){var t=new O("/static/img/avatar_male_light_frame_182x182.png",{lb:"sidekickapp",protocol:"https"}).href,n=A.pluck(e,"imageUrl"),i=A.every(n,function(e){return e===n[0]});i?t=n[0]:!function(){var e=A.map(n,function(e){return e.split("@")[1]}),i=A.every(e,function(t){return t===e[0]});i&&(t=new O("/socialintel/v1/avatars?domain="+e[0],{lb:"api",protocol:"https"}).href)}();return t},F=function(e,t){return x.Promise(function(n){var i=P.createElement("canvas");i.width=80;i.height=80;var o=i.getContext("2d");o.rect(0,0,i.width,i.height);var r=o.createLinearGradient(i.width,0,i.width,i.height);r.addColorStop(0,"#ccc");r.addColorStop(1,"#bbb");o.fillStyle=r;o.fill();var s=new f.Image,a=new f.Image;s.onload=function(){a.onload=function(){o.drawImage(a,0,62,i.width,18);var e=void 0;try{e=i.toDataURL("image/png")}catch(t){e=new O("/static/img/avatar_male_light_frame_182x182.png",{lb:"sidekickapp",protocol:"https"}).href}n(e)};o.drawImage(s,0,0,i.width,i.height);a.src=e.overlayImageUrl};s.src=q(t)})},G=function(e,t,n){return x.Promise(function(o){var r={title:e.bigTitle,iconUrl:n,eventTime:e.timestamp};e.buttons&&(r.buttons=A.map(e.buttons,function(e){return A.pick(e,"title","iconUrl")}));if(1===t.length){var s=M(e.timestamp).fromNow();e.textBeforeTimestamp.length>0&&(s=" "+s);r=_({},r,{type:"basic",message:e.showTimestamp?""+e.boldActionInfo+" "+e.textBeforeTimestamp+s:e.boldActionInfo})}else{t.reverse();var a=A.map(t,function(e){var t=R.truncate(e.boldActionInfo,i.MAX_LINE_LENGTH),n=""+M(e.timestamp).twitterShort()+" ago";return{title:t,message:""+e.textBeforeTimestamp+" "+n}});a.length>i.NOTIFICATION_MAXLINES&&(a[i.NOTIFICATION_MAXLINES-1]={title:"...",message:"and "+(a.length-i.NOTIFICATION_MAXLINES)+" more"});r=_({},r,{type:"list",items:a.slice(0,i.NOTIFICATION_MAXLINES),message:""})}var u=e.notificationKey;J(e,u,r,e.timestamp,!e.suppressTracking).then(o);T.log("Feeding notification to Chrome: ");T.log(r)})},J=function(e,t,i,o,r){var s=e.notificationSource;return x.Promise(function(e){N.notifications.update(t,{priority:0},function(a){if(r){T.log("Notification Sent - Extension: "+s);C("Notification Sent - Extension",{notificationAgeMinutes:Math.floor((new Date-o)/1e3/60),notificationSource:s});I.record("notification_sent_extension")}a?!function(){var n=i.priority||0;i.priority=1;N.notifications.update(t,i,function(){N.notifications.update(t,{priority:n},function(){T.log("Notification existed, re-showing...");e()})})}():N.notifications.create(t,i,function(){T.log("New notification created");n.incrementBadge();e()})})})},Y=function(e){var t=A.findWhere(U,{notificationKey:e}),n=t.link;null!=n&&"#"!==n&&D(n);N.notifications.clear(e)};k.notificationClicked=Y;var Q=function(e,t){var n=A.findWhere(U,{notificationKey:e}),i=n.buttons[t],o=i.clickAction,r=i.type,s=i.requestPayload,a=i.requestUrl;if(null!=o)o();else{var u={type:r,data:s};w.apiRequest(a,u)}N.notifications.clear(e)};k.buttonClicked=Q;return k});hubspot.define("SignalsExtension/background/notifications/pubnubHandler",["sidekick.chrome.common.utils.hubSpotApi","SignalsExtension/utils/contentScriptMessaging","SignalsExtension/background/backgroundMessaging","SignalsExtension/utils/tabs","SignalsExtension/background/notifications/manager","SignalsExtension/background/trackJsonAction","SignalsExtension/constants/Pubnub"],function(e,t,n,i,o,r,s){"use strict";var a={},u=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(a,"__esModule",{value:!0});var c=u(e),l=u(r);a=function(e){var r=e.messageType,a=e.data,u=e.timestamp;console.log("Received notification from PubNub: ",a);switch(r){case s.MESSAGE_TYPES.ACTIVITY:o.postNotificationFromActivity(a,u);break;case s.MESSAGE_TYPES.DOMAIN_ROTATION:n.sendToContentScripts("updateTrackingSlugs");t.sendToBackground("updateTrackingSlugs");l("Domain Rotation - Update Received");break;case s.MESSAGE_TYPES.COMMAND:if(a.command===s.COMMAND_TYPES.RELOAD){l("Extension - Forced Reload");i.restartExtension()}if(a.command===s.COMMAND_TYPES.PICKED_PORTAL_CHANGED){l("Extension - Picked Portal Changed");c.get().refreshAuthToken().then(function(){n.sendToContentScripts("message",{sender:"SIG_EXTENSION",type:"PICKED_PORTAL_CHANGED"})})}break;default:return}};return a});hubspot.define("SignalsExtension/background/startHublyticsListener",["SignalsExtension/globals/chrome","sidekick.chrome.utils.console","hubspot.HublyticsTrackerJS.SidekickTracker"],function(e,t,n){"use strict";var i={},o=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(i,"__esModule",{value:!0});var r=o(e),s=o(t),a=o(n);i=function(){try{a.init("sidekick",{});a.trackScreen("chrome")}catch(e){console.log(e)}r.runtime.onMessage.addListener(function(e){var t=e.type,n=e.payload;if("HUBLYTICS_EVENT"===t){a.track(n);s.debug("Logging Hublytics event: "+JSON.stringify(n))}})};return i});hubspot.define("SignalsExtension/background/startRemoteAssetUpdateListener",["SignalsExtension/globals/chrome","SignalsExtension/globals/localStorage","hubspot.HublyticsTrackerJS.SidekickTracker","sidekick.chrome.utils.console","moment","Kefir"],function(e,t,n,i,o,r){"use strict";var s={},a=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(s,"__esModule",{value:!0});var u=a(e),c=a(t),l=a(n),d=a(i),p=a(o),h=a(r),f="simulated-should-update",g=9e5,m=120,b=p(),k=p(),v=function(){c.setItem(f,!0)},_=function(e){if("active"!==e&&"true"===c.getItem(f)){l.trackInteraction("simulated-remote-asset-update-triggered",{what_extra_json:{updateType:e}});c.setItem(f,!1)}},y=function(e){var t=e.isAfter(b.add(26,"hours"));t&&(b=e);return t},S=function(e){var t=e.isAfter(k.add(8,"days"));t&&(k=e);return t},E=function(){d.debug("Starting hard updates");var e=h.withInterval(g,function(e){e.emit(p())});e.filter(y).onValue(v);e.filter(S).onValue(function(){return _("hard")});u.runtime.onMessage.addListener(function(e){var t=e.method;"requestIdlePermission"===t&&u.permissions.request({permissions:["idle"]},function(e){l.trackInteraction("idle-permission",{what_extra_json:{granted:e}});if(e){d.debug("Starting idle updates");u.idle.setDetectionInterval(m);u.idle.onStateChanged.addListener(_)}})})};s=E;return s});hubspot.define("SignalsExtension/background/trackJsonAction",["enviro","hubspot.HublyticsTrackerJS.SidekickTracker"],function(e,t){"use strict";var n={},i=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(n,"__esModule",{value:!0});var o=i(e),r=i(t),s=function(e){var t=void 0===arguments[1]?{}:arguments[1];if(o.deployed("hublyticstrackerjs")){var n=void 0;n=t.what_extra_json||t.what_event_subtype||t.what_value_str?t:{what_extra_json:t};r.trackInteraction(e,n)}};n=s;return n});hubspot.define("SignalsExtension/globals/Raven",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.Raven;return e});hubspot.define("SignalsExtension/globals/chrome",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=chrome;return e});hubspot.define("SignalsExtension/globals/document",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=document;return e});hubspot.define("SignalsExtension/globals/localStorage",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.localStorage;return e});hubspot.define("SignalsExtension/globals/location",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.location;return e});hubspot.define("SignalsExtension/globals/open",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.open;return e});hubspot.define("SignalsExtension/globals/setInterval",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.setInterval;return e});hubspot.define("SignalsExtension/globals/setTimeout",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window.setTimeout;return e});hubspot.define("SignalsExtension/globals/window",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});e=window;return e});hubspot.define("SignalsExtension/config/buildCdnUrl",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});var t=function(e){return"local"===e?"https://local.hsappstatic.net":"https://static.hsappstatic.net"},n=function(e,n){var i=void 0===arguments[2]?"":arguments[2],o=t(e);return"qa"===e?""+o+n+"-qa"+i:""+o+n+i};e=n;return e});hubspot.define("SignalsExtension/config/context",["enviro","Q","SignalsExtension/globals/location"],function(e,t,n){"use strict";var i={},o=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(i,"__esModule",{value:!0});var r=o(e),s=o(t),a=o(n);r.deployed("q")||(s.longStackSupport=!0);var u="chrome-extension:",c=a.pathname,l=a.protocol,d=l===u&&-1!==c.indexOf("background.html"),p=l===u&&-1!==c.indexOf("popup.html"),h=null;h=d?"background":p?"popup":"content_script";i=h;return i});hubspot.define("SignalsExtension/data/firstRunTracker",["Q","SignalsExtension/globals/chrome"],function(e,t){"use strict";var n={},i=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(n,"__esModule",{value:!0});var o=i(t),r=void 0,s=function(){o.storage.sync.get("first_time",function(e){r=null!=e.first_time?e.first_time:!0})};n.initFirstRunTracker=s;var a=function(){return r};n.isFirstRun=a;var u=function(){return e.Promise(function(e){r=!1;o.storage.sync.set({first_time:!1},e)})};n.setNotFirstRun=u;return n});hubspot.define("SignalsExtension/data/openSignup",["urlinator/Url","SignalsExtension/utils/tabs"],function(e,t){"use strict";var n={},i=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(n,"__esModule",{value:!0});var o=i(e),r=function(e){var t=new o("/sales/signup",{lb:"app",protocol:"https"}).href;return-1!==e.indexOf(t)},s=function(e){var t="no_redirect_after_install=true";return-1!==e.indexOf("getsidekick")&&-1!==e.indexOf(t)};n=function(){var e=!0;t.forAllTabs(null,function(t){var n=t.url;e=e&&!r(n)&&!s(n)});e&&t.openInActiveTab(new o("/signup/sales?utm_source=sales-extension-signup",{lb:"app",protocol:"https"}).href)};return n});hubspot.define("SignalsExtension/data/requestIdlePermission",["SignalsExtension/globals/document","SignalsExtension/globals/chrome","sidekick.chrome.utils.console","Kefir"],function(e,t,n,i){"use strict";var o={},r=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(o,"__esModule",{value:!0});var s=r(e),a=r(t),u=r(n),c=r(i),l=function(){u.debug("Requesting idle permission");a.runtime.sendMessage({method:"requestIdlePermission"})},d=function(){c.fromEvents(s.querySelector("body"),"click").take(1).onValue(l)};o=d;return o});hubspot.define("SignalsExtension/data/trackJsonAction",["SignalsExtension/globals/chrome"],function(e){"use strict";var t={},n=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(e),o=function(e,t){i.runtime.sendMessage({method:"trackJsonAction",action:e,props:t})};t=o;return t});hubspot.define("SignalsExtension/utils/RemoteAssets",["enviro","SignalsExtension/utils/loadCss","SignalsExtension/config/buildCdnUrl","sidekick.chrome.utils.console"],function(e,t,n,i){"use strict";var o={},r=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(o,"__esModule",{value:!0});var s=r(e),a=r(t),u=r(n),c=r(i),l=function(e){c.debug("Loading remote Background assets");var t=u(s.getShort("REMOTE_ASSETS"),"/SalesExtensionRemoteAssets/ex/background",".js");return e(t)};o.loadBackgroundRemoteAssets=l;var d=function(e){c.debug("Loading remote Gmail assets");var t=u(s.getShort("REMOTE_ASSETS"),"/SalesExtensionRemoteAssets/ex/gmail",".css"),n=u(s.getShort("REMOTE_ASSETS"),"/SalesExtensionRemoteAssets/ex/gmail",".js");a(t);return e(n)};o.loadGmailRemoteAssets=d;var p=function(e){c.debug("Loading remote Inbox assets");var t=u(s.getShort("REMOTE_ASSETS"),"/SalesExtensionRemoteAssets/ex/inbox",".css"),n=u(s.getShort("REMOTE_ASSETS"),"/SalesExtensionRemoteAssets/ex/inbox",".js");a(t);return e(n)};o.loadInboxRemoteAssets=p;return o});hubspot.define("SignalsExtension/utils/contentScriptMessaging",["sidekick.chrome.utils.console","SignalsExtension/globals/chrome"],function(e,t){"use strict";var n={},i=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(n,"__esModule",{value:!0});var o=i(e),r=i(t),s=function(e,t){r.runtime.sendMessage({method:e,data:t})};n.sendToBackground=s;var a=function(e,t,n){var i=function(i,r){if(null==r.tab&&i.method===e)try{t.apply(n,[i.data])}catch(s){o.error(s);o.info(e);o.debug(i.data);o.debug(n)}};r.runtime.onMessage.addListener(i)};n.listenToBackground=a;return n});hubspot.define("SignalsExtension/utils/extensionManager",["Q","_","SignalsExtension/globals/chrome","sidekick.chrome.backbone.models.user"],function(e,t,n,i){"use strict";var o={},r=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(o,"__esModule",{value:!0});var s=r(t),a=r(n),u=r(i),c={attempts:0,deferred:e.defer(),active:!1},l=null,d=function(){if(c.active)return c.deferred.promise;l=a.runtime.connect();l.onDisconnect.addListener(p);l.onMessage.addListener(f);c.active=!0;return c.deferred.promise},p=function(){c.active=!1;c.attempts=c.attempts+1;c.attempts<20?s.delay(d,1e3):s.delay(d,1e4)},h=function(e){l.onDisconnect.removeListener(p);u.set(e.user_profile,{ext_sync:!0});c.deferred.resolve()},f=function(e){switch(e.method){case"userModel":h(e)}};o={connect:d};return o});hubspot.define("SignalsExtension/utils/getChromeVersion",["SignalsExtension/globals/window"],function(e){"use strict";var t={},n=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(e),o=function(){return parseInt(i.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10)};t=o;return t});hubspot.define("SignalsExtension/utils/inboxSDKLoadJS",["InboxSDK"],function(e){"use strict";var t={},n=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(e);t=function(e){return i.loadScript(e,{nowrap:!0})};return t});hubspot.define("SignalsExtension/utils/loadCss",["Q","SignalsExtension/globals/document"],function(e,t){"use strict";var n={},i=function(e){return e&&e.__esModule?e["default"]:e;
};Object.defineProperty(n,"__esModule",{value:!0});var o=i(e),r=i(t),s=function(e){return o.promise(function(t,n){var i=r.createElement("link");i.rel="stylesheet";i.type="text/css";i.onload=function(){return t()};i.onerror=function(){return n()};i.href=e;r.head.appendChild(i)})};n=s;return n});hubspot.define("SignalsExtension/utils/loadJS",["Q"],function(e){"use strict";var t={};Object.defineProperty(t,"__esModule",{value:!0});t=function(t){return e.promise(function(e,n){var i=document.createElement("script");i.src=t;document.body.appendChild(i);i.onload=function(){return e()};i.onerror=function(){return n()}})};return t});hubspot.define("SignalsExtension/utils/onSidekickCookieChanged",["_","enviro","SignalsExtension/globals/chrome","sidekick.chrome.constants.cookieDescriptors"],function(e,t,n,i){"use strict";var o={},r=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(o,"__esModule",{value:!0});var s=r(t),a=r(n);o=function(t,n){a.cookies.onChanged.addListener(function(o){var r=o.cookie,a=i.SIDEKICK_COOKIE[s.getShort("api")],u=e.str.include(r.domain,a.domain);u&&r.name===t&&n(o)})};return o});hubspot.define("SignalsExtension/utils/tabs",["enviro","SignalsExtension/globals/chrome","SignalsExtension/globals/setTimeout"],function(e,t,n){"use strict";var i={},o=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(i,"__esModule",{value:!0});var r=o(e),s=o(t),a=o(n),u=function(e,t){s.tabs.query({},function(n){var i=!0,o=!1,r=void 0;try{for(var s,a=Array.from(n)[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value;(null==e||-1!==u.url.indexOf(e))&&t(u)}}catch(c){o=!0;r=c}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw r}}})},c=function(e,t){return u(t,function(t){"close"===e?s.tabs.remove(t.id):"reload"===e&&s.tabs.reload(t.id)})},l=function(){var e=r.isProd()?"getsidekick.com":"getsidekickqa.com";c("close",e)},d=function(){l();var e=s.runtime.reload;a(e,500)},p=function(){return c("reload","mail.google.com")},h=function(e){return s.tabs.create({url:e,index:1e3})},f=function(e){return s.tabs.query({active:!0},function(t){return s.tabs.update(t.id,{url:e})})};i={restartExtension:d,reloadGmailTabs:p,closeTabs:c,openNewTab:h,openInActiveTab:f,forAllTabs:u};return i});hubspot.define("SignalsExtension/constants/InboxSdk",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});var t="sdk_SIDEKICK_ab674cd386";e.APP_ID=t;return e});hubspot.define("SignalsExtension/constants/OnboardingFlows",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});var t={INVITED_PAID:"INVITED_PAID",INAPP_CRM:"INAPP_CRM",INAPP_ACTIVITY_STREAM:"INAPP_ACTIVITY_STREAM"};e=t;return e});hubspot.define("SignalsExtension/constants/Pubnub",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});var t={ACTIVITY:"ACTIVITY",COMMAND:"CHROME_CONTROL",DOMAIN_ROTATION:"DOMAIN_ROTATION"},n={RELOAD:"RELOAD",PICKED_PORTAL_CHANGED:"PICKED_PORTAL_CHANGED"},i="sidekick.chrome.background.pubnub.uuid",o="pubnub/v1/configuration",r=6e4;e={MESSAGE_TYPES:t,COMMAND_TYPES:n,UUID_STORAGE_KEY:i,CONFIG_ENDPOINT:o,ERROR_RETRY_RATE:r};return e});hubspot.define("SignalsExtension/constants/TemplateOnboardingMoleTriggers",[],function(){"use strict";var e={};Object.defineProperty(e,"__esModule",{value:!0});var t="templates-onboarding-modal-trigger:on-page-load",n="templates-onboarding-modal-trigger:on-compose",i="templates-onboarding-modal-trigger:on-send",o="NONE";e={ON_PAGE_LOAD:t,ON_COMPOSE:n,ON_SEND:i,NONE:o};return e});hubspot.define("SignalsExtension/init/Background",["SignalsExtension/background/browserAction","sidekick.chrome.common.utils.hubSpotApi","SignalsExtension/background/accountManager","sidekick.chrome.background.requestBlocker","sidekick.chrome.trackerSaver","SignalsExtension/background/notifications/manager","sidekick.chrome.background.updateManager","sidekick.chrome.backbone.models.domainRotations","SignalsExtension/background/startHublyticsListener","SignalsExtension/background/startRemoteAssetUpdateListener","SignalsExtension/utils/RemoteAssets","SignalsExtension/utils/loadJS","SignalsExtension/background/notifications/activityHandlerRegistration","SignalsExtension/data/firstRunTracker","SignalsExtension/background/extensionActions"],function(e,t,n,i,o,r,s,a,u,c,l,d,p,h,f){"use strict";var g={},m=function(e){return e&&e.__esModule?e["default"]:e},b=m(e),k=m(t),v=m(n),_=m(i),y=m(o),S=m(s),E=m(a),T=m(u),I=m(c),w=m(d),x=m(p),A=m(f);hubspot.require(["sidekick.chrome.userData","sidekick.chrome.utils.console","sidekick.chrome.utils.http","sidekick.chrome.utils.sidekickApi","sidekick.chrome.utils.matchers","sidekick.chrome.backbone.models.user","sidekick.chrome.backbone.models.options"]);T();I();h.initFirstRunTracker();A.init();b.init();v.init();_.init();y.init();E.fetch();r.init();k.get().refreshAuthToken();S.start();x();l.loadBackgroundRemoteAssets(w).then(function(){hubspot.require(["SalesExtensionRemoteAssets/background/init"],function(e){return e()})}).done();return g});hubspot.require(["SignalsExtension/init/Background"]);hubspot.define("SignalsExtension/init/Popup",["_","Kefir","sidekick.chrome.backbone.models.options","SignalsExtension/background/accountManager","SignalsExtension/background/browserAction","sidekick.chrome.background.notifications.doNotDisturb","sidekick.chrome.common.utils.hubSpotApi","urlinator/Url"],function(e,t,n,i,o,r,s,a){"use strict";var u={},c=function(e){return e&&e.__esModule?e["default"]:e};Object.defineProperty(u,"__esModule",{value:!0});var l=c(n),d=c(o),p=c(r),h=c(s),f=c(a),g=function(n){var o=n.document,r=n.window,s=t.fromEvents(r,"message").filter(function(e){if(!e.data)return!1;var t=e.data,n=t.sender,i=t.type;return"ACTIVITY_FEED"===n&&"DO_NOT_DISTURB"===i}),a=function(t,n){var i=o.querySelector("#firealarm"),r=i.querySelector("#firealarm-msg");if(t){i.style.display="";r.innerHTML=n;e.each(r.querySelectorAll("a:link"),function(e){e.target="_blank"})}else i.style.display="none"},u=function(e){return d.checkAlarm()["finally"](function(){d.updateIcon(e);a(l.hasAlarm(),l.getAlarmStatus())})};d.clearBadge();var c=function(e){var t=new f(e,{lb:"app",protocol:"https"}).href;o.querySelector("#streamIframe iframe").src=t};i.checkLoggedIn(function(e){u(e);d.updateIcon(e);e?h.get().getPortalId().then(function(e){c("/sales-notifications-embedded/"+e+"/all?source=extension")}).done():c("/sales-notifications-embedded?source=extension")});s.onValue(function(e){var t=e.data.content;p.set(t.doNotDisturb);d.updateIcon(!0)})};u.init=g;return u});