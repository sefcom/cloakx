// Load Template Modules

$('.E2Module').each(function(){
	var elem = $(this);
	$.ajax({
		url:"Module/"+$(this).attr('template')+".html?t=" + new Date().getTime(),
		async:false,
		dataType: 'html',
		success: function(data){
			elem.replaceWith(data);
		}
	});
});

var SEModuleHelper = {
    convertWeekDate : function(dDate){
        var now = new Date();
        //var local = new Date(dDate.toLocaleString());
        //if(!isNaN(local)){
        if (dDate instanceof Date) {
            var local = dDate;
            var resultDate;

            var minutes = (local.getMinutes() < 10)? '0'+local.getMinutes() : local.getMinutes();
            var hours = local.getHours();
            var ampm;

            var date = (local.getDate() < 10)? '0'+local.getDate() : local.getDate();
            var month = local.getMonth();
            var day = local.getDay();
            // month = (month < 10)? '0'+month : month
            var weekArray = Locale.Date.WEEK;
            for(var i = 0; i < weekArray.length; i++) {
                weekArray[i] = weekArray[i].toUpperCase();
            }

            if (hours == 0) {
                hours = '12';
                ampm = Locale.Date.AM;
            } else if (hours < 12) {
                ampm = Locale.Date.AM;
            } else if (hours == 12) {
                ampm = Locale.Date.PM;
            } else {
                hours -= 12;
                ampm = Locale.Date.PM;
            }

            resultDate = weekArray[day]+" "+hours+":"+minutes+ampm;

            return resultDate;
        }
    },
	convertShortDate : function(dDate){
		var now = new Date();
		//var local = new Date(dDate.toLocaleString());
		//if(!isNaN(local)){
		if (dDate instanceof Date) {
			var local = dDate;
			var resultDate;

			var minutes = (local.getMinutes() < 10)? '0'+local.getMinutes() : local.getMinutes();
			var hours = local.getHours();
			var ampm;

			var date = (local.getDate() < 10)? '0'+local.getDate() : local.getDate();
			var month = local.getMonth();
			// month = (month < 10)? '0'+month : month

            var monthArray = Locale.Date.MONTH;
            for(var i = 0; i < monthArray.length; i++) {
                monthArray[i] = monthArray[i].toUpperCase();
            }

            if (hours == 0) {
                hours = '12';
                ampm = Locale.Date.AM;
            } else if (hours < 12) {
                ampm = Locale.Date.AM;
            } else if (hours == 12) {
                ampm = Locale.Date.PM;
            } else {
                hours -= 12;
                ampm = Locale.Date.PM;
            }

			if(now.getFullYear() == local.getFullYear() && now.getDate() == local.getDate() && now.getMonth() == local.getMonth()){
				//resultDate = "TODAY "+hours+":"+minutes+ampm;
				resultDate = hours+":"+minutes+ampm;
			}else if(now.getFullYear() == local.getFullYear()){
				resultDate = monthArray[month]+' ' + date+", "+hours+":"+minutes+ampm;
			}else{
				var date = (local.getDate() < 10)? '0'+local.getDate() : local.getDate();
				resultDate = monthArray[month]+' ' + date+' ' + local.getFullYear();
			}

			return resultDate;
		}
	},
    convertDate : function(dDate) {
        var now = new Date();
        //var local = new Date(dDate.toLocaleString());
        //if (!isNaN(local)) {
		if (dDate instanceof Date) {
            var local = dDate;
            var resultDate;

            var minutes = (local.getMinutes() < 10) ? '0' + local.getMinutes() : local.getMinutes();
            var hours = local.getHours();
            var ampm;

            var date = (local.getDate() < 10) ? '0' + local.getDate() : local.getDate();
            var month = local.getMonth();
            // month = (month < 10)? '0'+month : month
            var monthArray = Locale.Date.MONTH;

            if (hours == 0) {
                hours = '12';
                ampm = Locale.Date.AM;
            } else if (hours < 12) {
                ampm = Locale.Date.AM;
            } else if (hours == 12) {
                ampm = Locale.Date.PM;
            } else {
                hours -= 12;
                ampm = Locale.Date.PM;
            }

            if (now.getFullYear() == local.getFullYear() && now.getDate() == local.getDate() && now.getMonth() == local.getMonth()) {

                resultDate = Locale.Date.TODAY + " " + hours + ":" + minutes + ampm;
            } else if (now.getFullYear() == local.getFullYear()) {
                resultDate = monthArray[month] + ' ' + date + ", " + hours + ":" + minutes + ampm;
            } else {
                var date = (local.getDate() < 10) ? '0' + local.getDate() : local.getDate();
                resultDate = monthArray[month] + ' ' + date + ' ' + local.getFullYear();
            }

            return resultDate;
        }
    }
};

if(typeof module !== 'undefined' && module.exports){
    module.exports = SEModuleHelper;
}
