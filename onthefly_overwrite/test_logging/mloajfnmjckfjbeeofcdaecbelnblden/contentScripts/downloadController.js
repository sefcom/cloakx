(function(q){function n(g){var c={},h={text:[],margin:[0,6,0,0]},e=function(b){for(b=b.firstChild;b;)a(b),b=b.nextSibling},a=function(a){switch(a.nodeName.toLowerCase()){case "#text":var d={};d.text=a.textContent;c.hasOwnProperty("bold")&&c.bold&&(d.bold=!0);c.hasOwnProperty("italics")&&c.italics&&(d.italics=!0);c.hasOwnProperty("decoration")&&c.decoration&&(d.decoration=c.decoration);h.text.push(d);break;case "b":c.bold=!0;e(a);c.bold=!1;break;case "i":c.italics=!0;e(a);c.italics=!1;break;case "u":c.decoration=
"underline",e(a),c.decoration=!1}};g=$.parseHTML(g);for(var f=0;f<g.length;f++)a(g[f]);return h}function p(g,c,h){var e,a;a=h.body();a=a.trim();a=a.replace(/[\r\n]/g," ");a=a.replace(/\r/g,"");a=a.replace(/\n/g," ");for(var f=n(a),b=h.sources(),d=[],l,k,m=0;m<b.length;m++)k=b[m].cslData(),a=e=void 0,l=null,k?(e=k.author&&0<k.author.length&&""!=k.author[0].family?k.author[0].family:k["container-title"],k.issued&&k.issued.year&&(l=k.issued.year),e=e&&l?e+" "+l:e?e:"...",k.URL&&(a=k.URL)):k||(e=b[m].author().split(",")[0]),
d.push("("),a?d.push({text:e,color:"blue"}):d.push(e),d.push(m===b.length-1?")":"), ");a=[f,{text:d,margin:[0,3,0,0]}];h=c.topics(h);if(0<h.length){f={ul:[]};for(b=0;b<h.length;b++)p(f,c,h[b]);a.push(f)}g.ul.push(a)}q.download=function(g,c){var h=function(){dji.ui.effects.leaveBusyState()};dji.ui.effects.enterBusyState();setTimeout(function(){var e=(g.isSkeleton()?"Outline Name":g.title())+".pdf",a=g.isSkeleton()?"Outline Name":g.title(),f={pageSize:"A4",pageOrientation:"portrait",pageMargins:40,
content:[]};f.content.push({margin:[0,10,0,20],text:a,alignment:"center",fontSize:16,bold:!0});f.content.push({margin:[0,10],text:"Topics",fontSize:14,bold:!0});for(var b={fontSize:12,ul:[]},d=g.topics(),a=0;a<d.length;a++)p(b,g,d[a]);0<b.ul.length&&f.content.push(b);f.content.push({margin:[0,10],text:"Source",fontSize:14,bold:!0});b={fontSize:12,ul:[]};d=g.sources();for(a=0;a<d.length;a++){var l=(d[a].text(c)||"generate citation from source.data.fields with style "+c).trim();-1!==l.indexOf('class="csl-entry"')&&
(l=l.substr(23),l=l.slice(0,-6));b.ul.push(n(l))}0<b.ul.length&&f.content.push(b);pdfMake.createPdf(f).download(e);h&&h()},0)}})(window.sru.downloadController=window.sru.downloadController||{});
