window.sru=window.sru||{};
(function(c){function k(a){if((a=a.data)&&"com.donjohnston.sru.measureText"===a.message&&a.params.session===g){sru.userData.measurements.update(a.params.scope,a.params.uuid,a.params.measurements);var b=e[a.params.uuid];b&&(delete e[a.params.uuid],b({measurements:a.params.measurements}))}}var b=null,g=dji.utils.generateUUID(),e={};c.Scope={Page:0,TTS:1};c.reset=function(){g=dji.utils.generateUUID();e={};b&&(b.terminate(),b=null);b=new Worker("measurementsWorker.js");b.addEventListener("message",k)};
c.update=function(a,c,h){var d;a:{switch(a.scope){case sru.measurements.Scope.Page:d="page";break a;case sru.measurements.Scope.TTS:d="tts";break a}d=null}if(b&&d&&!sru.userData.privacyMode()){var f={};a.isNew&&(f.dateViewed=Date.now());a.uuid=a.uuid||dji.utils.generateUUID();f.timeSpent=a.timeSpent||0;a.scope===sru.measurements.Scope.TTS&&(f.pageUuid=a.pageUuid);h&&(e[a.uuid]=h);b.postMessage({message:"com.donjohnston.sru.measureText",params:{session:g,scope:d,uuid:a.uuid,text:a.text,measurements:f,
allowEmptyText:a.isNew}});c&&c(a.uuid)}else c&&c(null)};c.reset()})(window.sru.measurements=window.sru.measurements||{});
